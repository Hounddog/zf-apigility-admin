!function(){"use strict";angular.module("ag-admin",["ui.router","ngSanitize","ngTagsInput","angular-flash.service","angular-flash.flash-alert-directive","ui.sortable","ui.select2","toggle-switch"]).config(["$provide","$stateProvider","$urlRouterProvider",function(a,b,c){a.value("apiBasePath",angular.element("body").data("api-base-path")||"/admin/api"),b.state("ag",{"abstract":!0,views:{breadcrumbs:{templateUrl:"html/breadcrumbs.html",controller:["$rootScope","$scope","$state",function(a,b,c){b.breadcrumbs=[];var d={title:"Home",href:"ag.settings.overview",active:!1},e=function(a){if(!a.url||!a.data)return!1;if(!a.data.pageTitle&&!a.data.breadcrumb)return!1;var b="";"string"==typeof a.data.breadcrumb?b=a.data.breadcrumb:"function"==typeof a.data.breadcrumb?b=a.data.breadcrumb(c.params):a.data.pageTitle&&(b=a.data.pageTitle);var d={title:b,href:a.name,active:!1};return d},f=function(){for(var a=[],f=c.$current.name,g=c.$current;"ag"!==g.name;){var h=e(g);if(h&&(g.name===f&&(h.active=!0),a.unshift(h)),!g.parent)break;g=g.parent}a.unshift(d);var i=[];a=a.filter(function(a){return-1===i.lastIndexOf(a.href)?(i.push(a.href),!0):!1}),b.breadcrumbs=a,b.params=c.params};a.$on("$stateChangeSuccess",f),f()}]},title:{template:'<h1 ng-bind="pageTitle"></h1>',controller:["$rootScope","$scope","$state",function(a,b,c){var d=function(a,d){if(a!==d&&d){var e;c.current&&c.current.data&&c.current.data.pageTitle&&("string"==typeof c.current.data.pageTitle?e=c.current.data.pageTitle:"function"==typeof c.current.data.pageTitle&&(e=c.current.data.pageTitle(c.params))),b.pageTitle=e}};a.$on("$stateChangeSuccess",function(){d(null,c.$current.name)}),d(null,c)}]},sidebar:{templateUrl:"html/settings/sidebar.html",controller:["$scope","$state",function(a,b){var c=function(){a.active=b.current.name};a.$watch(function(){return b.current.name},c),c()}]}}}),b.state("ag.settings",{"abstract":!0,url:"/settings"}),b.state("ag.settings.overview",{url:"/overview",data:{pageTitle:"Settings"},views:{"content@":{templateUrl:"html/settings/dashboard.html"}}}),b.state("ag.settings.authentication",{url:"/authentication",data:{pageTitle:"Authentication"},views:{"content@":{templateUrl:"html/settings/authentication/index.html",controller:"AuthenticationController"}}}),b.state("ag.settings.content-negotiation",{url:"/content-negotiation",data:{pageTitle:"Content Negotiation"},resolve:{selectors:["ContentNegotiationResource",function(a){return a.getList()}]},views:{"content@":{templateUrl:"html/settings/content-negotiation/index.html",controller:"ContentNegotiationController"}}}),b.state("ag.settings.db-adapters",{url:"/db-adapters",data:{pageTitle:"Database Adapters"},resolve:{dbAdapters:["DbAdapterResource",function(a){return a.getList()}]},views:{"content@":{templateUrl:"html/settings/db-adapters/index.html",controller:"DbAdapterController"}}}),b.state("ag.api",{url:"/api",data:{pageTitle:"APIs"},resolve:{apis:["ApiRepository",function(a){return a.getList(!0)}]},views:{"content@":{templateUrl:"html/api/index.html",controller:"ApiController"},"sidebar@":{templateUrl:"html/api/index-sidebar.html"}}}),b.state("ag.api.version",{url:"/:apiName/v:version",data:{pageTitle:function(a){return a.apiName+" (v"+a.version+")"},breadcrumb:function(a){return a.apiName+" (v"+a.version+")"}},resolve:{api:["$stateParams","ApiRepository",function(a,b){return b.getApi(a.apiName,a.version,!0)}],filters:["FiltersServicesRepository",function(a){return a.getList()}],validators:["ValidatorsServicesRepository",function(a){return a.getList()}],selectors:["ContentNegotiationResource",function(a){return a.getList().then(function(a){var b=[];return angular.forEach(a,function(a){b.push(a.content_name)}),b})}]},views:{"content@":{templateUrl:"html/api/overview.html",controller:"ApiOverviewController"},"sidebar@":{templateUrl:"html/api/sidebar.html",controller:["$scope","$state",function(a,b){var c=function(){a.active=b.current.name};a.$watch(function(){return b.current.name},c),c()}]}}}),b.state("ag.api.version.authorization",{url:"/authorization",data:{pageTitle:"Authorization",breadcrumb:!1},resolve:{apiAuthorizations:["$stateParams","ApiAuthorizationRepository",function(a,b){return b.getApiAuthorization(a.apiName,a.version)}],authentication:["AuthenticationRepository",function(a){return a.hasAuthentication()}]},views:{"content@":{templateUrl:"html/api/authorization.html",controller:"ApiAuthorizationController"}}}),b.state("ag.api.version.rest",{url:"/rest-services",data:{pageTitle:"REST Services",breadcrumb:!1},resolve:{dbAdapters:["DbAdapterResource",function(a){return a.getList()}],hydrators:["HydratorServicesRepository",function(a){return a.getList()}]},views:{"content@":{templateUrl:"html/api/rest-services/index.html",controller:"ApiRestServicesController"}}}),b.state("ag.api.version.rpc",{url:"/rpc-services",data:{pageTitle:"RPC Services",breadcrumb:!1},views:{"content@":{templateUrl:"html/api/rpc-services/index.html",controller:"ApiRpcServicesController"}}}),c.otherwise("/settings/overview")}])}(),function(){"use strict";angular.module("ag-admin").controller("ApiController",["$scope","$state","$timeout","flash","apis","ApiRepository",function(a,b,c,d,e,f){a.showNewApiForm=!1,a.apiList=[];var g=(b.current.name,function(b){var c=[];angular.forEach(b,function(a){c.push({apiName:a.name,version:a.versions.pop()})}),a.apiList=c});a.createNewApi=function(e){var h=angular.element(e.target);h.find("input").attr("disabled",!0),h.find("button").attr("disabled",!0),f.createNewApi(a.apiName).then(function(e){a.dismissModal(),a.resetForm(),h.find("input").attr("disabled",!1),h.find("button").attr("disabled",!1),d.success="New API Created",c(function(){f.getList(!0).then(function(a){g(a)}),b.go("ag.api.version",{apiName:e.name,version:1})},500)})},a.resetForm=function(){a.showNewApiForm=!1,a.apiName=""},g(e)}])}(),function(a){"use strict";angular.module("ag-admin").controller("ApiAuthorizationController",["$scope","$stateParams","flash","api","apiAuthorizations","authentication","ApiAuthorizationRepository",function(b,c,d,e,f,g,h){b.api=e,b.apiAuthorizations=f,b.authentication=g;var i=c.version.match(/\d/g)[0]||1;b.editable=i==e.versions[e.versions.length-1];var j=function(){var a={};return angular.forEach(e.restServices,function(b){var c=b.controller_service_name+"::__resource__",d=b.controller_service_name+"::__collection__",e={GET:!1,POST:!1,PUT:!1,PATCH:!1,DELETE:!1},f={GET:!1,POST:!1,PUT:!1,PATCH:!1,DELETE:!1};angular.forEach(b.entity_http_methods,function(a){e[a]=!0}),angular.forEach(b.collection_http_methods,function(a){f[a]=!0}),a[c]=e,a[d]=f}),angular.forEach(e.rpcServices,function(b){var c=b.controller_service_name,d={GET:!1,POST:!1,PUT:!1,PATCH:!1,DELETE:!1};angular.forEach(b.http_methods,function(a){d[a]=!0}),a[c]=d}),a}();b.isEditable=function(a,c){if(!b.editable)return!1;if(!j.hasOwnProperty(a)){var d=a.split("::"),e=d[0];if(!j.hasOwnProperty(e))return!1;a=e}return j[a][c]},b.saveAuthorization=function(){d.success="Authorization settings saved",h.saveApiAuthorizations(c.apiName,b.apiAuthorizations)},b.updateColumn=function(a,c){angular.forEach(b.apiAuthorizations,function(d,e){b.isEditable(e,c)&&(b.apiAuthorizations[e][c]=a.target.checked)})},b.updateRow=function(c,d){a.forEach(["GET","POST","PUT","PATCH","DELETE"],function(a){b.isEditable(d,a)&&(b.apiAuthorizations[d][a]=c.target.checked)})},b.showTopSaveButton=function(){return Object.keys(f).length>10}}])}(_),function(a){"use strict";angular.module("ag-admin").controller("ApiDocumentationController",["$scope","$stateParams","flash","ApiRepository","ApiAuthorizationRepository",function(b,c,d,e,f){var g=c.apiName,h=c.version,i={};b.service="undefined"!=typeof b.$parent.restService?b.$parent.restService:b.$parent.rpcService,b.authorizations={},"undefined"!=typeof b.$parent.restService?("undefined"==typeof b.service.documentation&&(b.service.documentation={}),Array.isArray(b.service.documentation)&&(i={},a.forEach(b.service.documentation,function(a,b){i[b]=a}),b.service.documentation=i),"undefined"==typeof b.service.documentation.collection&&(b.service.documentation.collection={}),a.forEach(b.service.collection_http_methods,function(a){"undefined"==typeof b.service.documentation.collection[a]&&(b.service.documentation.collection[a]={description:null,request:null,response:null})}),"undefined"==typeof b.service.documentation.entity&&(b.service.documentation.entity={}),a.forEach(b.service.entity_http_methods,function(a){"undefined"==typeof b.service.documentation.entity[a]&&(b.service.documentation.entity[a]={description:null,request:null,response:null})})):("undefined"==typeof b.service.documentation&&(b.service.documentation={}),Array.isArray(b.service.documentation)&&(i={},a.forEach(b.service.documentation,function(a,b){i[b]=a}),b.service.documentation=i),a.forEach(b.service.http_methods,function(a){"undefined"==typeof b.service.documentation[a]&&(b.service.documentation[a]={description:null,request:null,response:null})})),f.getServiceAuthorizations(b.service,g,h).then(function(a){b.authorizations=a}),b.requiresAuthorization=function(a,c){var d=b.authorizations;return"entity"==c||"collection"==c?d[c][a]:d[a]};var j=function(a){return"object"==typeof a&&Array.isArray(a)?-1===a.lastIndexOf("application/hal+json")?!1:!0:!1},k=function(a){return new Array(4*a).join(" ")},l=function(a,b,c,d,e){return"collection"==e&&(b=b.replace(/\[[a-zA-Z0-9_\/:\-]+\]$/,"")),d&&(b+=d),k(c)+'"'+a+'": {\n'+k(c+1)+'"href": "'+b+'"\n'+k(c)+"}"},m=function(a,b){return k(b)+'"_links": {\n'+a.join(",\n")+"\n"+k(b)+"}\n"},n=function(a,b,c){var d=[l("self",b,5)],e=k(1)+'"_embedded": {\n'+k(2)+'"'+a+'": [\n'+k(3)+"{\n";return e+=m(d,4),e+=c.join(",\n")+"\n"+k(3)+"}\n"+k(2)+"]\n"+k(1)+"}"};b.generate=function(c,d,e,f){var g="",h=[],i=!1,o=[];if("response"==e&&b.service.accept_whitelist&&(i=j(b.service.accept_whitelist)),a.forEach(b.service.input_filter,function(a){h.push(k(1)+'"'+a.name+'": "'+(a.description||"")+'"')}),!i||"collection"==f&&"POST"!=d)if(i&&"collection"==f){var p=b.service.collection_name?b.service.collection_name:"items";a.forEach(h,function(a,b){h[b]=k(3)+a}),o.push(l("self",b.service.route_match,2,!1,"collection")),o.push(l("first",b.service.route_match,2,"?page={page}","collection")),o.push(l("prev",b.service.route_match,2,"?page={page}","collection")),o.push(l("next",b.service.route_match,2,"?page={page}","collection")),o.push(l("last",b.service.route_match,2,"?page={page}","collection")),g="{\n"+m(o,1)+n(p,b.service.route_match,h)+"\n}"}else g="{\n"+h.join(",\n")+"\n}";else o.push(l("self",b.service.route_match,2)),g="{\n"+m(o,1)+h.join(",\n")+"\n}";c[e]?c[e]+="\n"+g:c[e]=g},b.save=function(){Array.isArray(b.service.documentation)&&(i={},a.forEach(b.service.documentation,function(a,b){i[b]=a}),b.service.documentation=i),e.saveDocumentation(b.service),b.$parent.flash.success="Documentation saved."}}])}(_),function(){"use strict";angular.module("ag-admin").controller("ApiListController",["$rootScope","$scope","ApiRepository",function(a,b,c){b.apis=[],b.refreshApiList=function(){c.getList(!0).then(function(a){b.apis=a})},a.$on("refreshApiList",function(){b.refreshApiList()})}])}(),function(){"use strict";angular.module("ag-admin").controller("ApiOverviewController",["$scope","flash","api","ApiRepository",function(a,b,c,d){a.api=c,a.defaultApiVersion=c.default_version,a.setDefaultApiVersion=function(){b.info="Setting the default API version to "+a.defaultApiVersion,d.setDefaultApiVersion(a.api.name,a.defaultApiVersion).then(function(c){b.success="Default API version updated",a.defaultApiVersion=c.version})}}])}(),function(a){"use strict";angular.module("ag-admin").controller("ApiRestServicesController",["$scope","$timeout","$sce","flash","filters","hydrators","validators","selectors","ApiRepository","api","dbAdapters","toggleSelection",function(b,c,d,e,f,g,h,i,j,k,l,m){b.ApiRepository=j,b.flash=e,b.api=k,b.dbAdapters=l,b.filterOptions=f,b.hydrators=g,b.validatorOptions=h,b.selectors=i,b.sourceCode=[],b.deleteRestService=!1,b.toggleSelection=m,b.resetForm=function(){b.showNewRestServiceForm=!1,b.newService.restServiceName="",b.newService.dbAdapterName="",b.newService.dbTableName=""},b.isLatestVersion=function(){return b.ApiRepository.isLatestVersion(b.api)},b.isDbConnected=function(a){return"object"!=typeof a||"undefined"==typeof a?!1:a.hasOwnProperty("adapter_name")||a.hasOwnProperty("table_name")||a.hasOwnProperty("table_service")?!0:!1},b.newService={restServiceName:"",dbAdapterName:"",dbTableName:""},b.newService.createNewRestService=function(){j.createNewRestService(b.api.name,b.newService.restServiceName).then(function(){e.success="New REST Service created",c(function(){j.getApi(b.api.name,b.api.version,!0).then(function(a){b.api=a,b.currentVersion=a.currentVersion})},500),b.showNewRestServiceForm=!1,b.newService.restServiceName=""},function(){})},b.newService.createNewDbConnectedService=function(){j.createNewDbConnectedService(b.api.name,b.newService.dbAdapterName,b.newService.dbTableName).then(function(){e.success="New DB Connected Service created",c(function(){j.getApi(b.api.name,b.api.version,!0).then(function(a){b.api=a})},500),b.showNewRestServiceForm=!1,b.newService.dbAdapterName="",b.newService.dbTableName=""},function(){})},b.saveRestService=function(c){var d=a.clone(b.api.restServices[c]);j.saveRestService(b.api.name,d).then(function(){e.success="REST Service updated"})},b.removeRestService=function(a){j.removeRestService(b.api.name,a).then(function(){e.success="REST Service deleted",b.deleteRestService=!1,c(function(){j.getApi(b.api.name,b.api.version,!0).then(function(a){b.api=a,b.currentVersion=a.currentVersion})},500)})},b.getSourceCode=function(a,c){j.getSourceCode(b.api.name,a).then(function(e){b.filename=a+".php",b.classType=c+" Class",b.sourceCode="string"==typeof e.source?d.trustAsHtml(e.source):""})}}])}(_),function(a){"use strict";angular.module("ag-admin").controller("ApiRpcServicesController",["$scope","$timeout","$sce","flash","filters","validators","selectors","ApiRepository","api","toggleSelection",function(b,c,d,e,f,g,h,i,j,k){b.ApiRepository=i,b.flash=e,b.api=j,b.toggleSelection=k,b.filterOptions=f,b.validatorOptions=g,b.selectors=h,b.sourceCode=[],b.deleteRpcService=!1,b.resetForm=function(){b.showNewRpcServiceForm=!1,b.rpcServiceName="",b.rpcServiceRoute=""},b.isLatestVersion=function(){return b.ApiRepository.isLatestVersion(b.api)},b.createNewRpcService=function(){i.createNewRpcService(b.api.name,b.rpcServiceName,b.rpcServiceRoute).then(function(){e.success="New RPC Service created",c(function(){i.getApi(b.api.name,b.api.version,!0).then(function(a){b.api=a,b.currentVersion=a.currentVersion})},500),b.addRpcService=!1,b.resetForm()})},b.saveRpcService=function(c){var d=a.clone(b.api.rpcServices[c]);i.saveRpcService(b.api.name,d).then(function(){e.success="RPC Service updated"})},b.removeRpcService=function(a){i.removeRpcService(b.api.name,a).then(function(){e.success="RPC Service deleted",b.deleteRpcService=!1,c(function(){i.getApi(b.api.name,b.api.version,!0).then(function(a){b.api=a,b.currentVersion=a.currentVersion})},500)})},b.getSourceCode=function(a,c){i.getSourceCode(b.api.name,a).then(function(e){b.filename=a+".php",b.classType=c+" Class",b.sourceCode="string"==typeof e.source?d.trustAsHtml(e.source):""})}}])}(_),function(a){"use strict";angular.module("ag-admin").controller("ApiServiceInputController",["$scope","flash",function(b,c){b.service="undefined"!=typeof b.$parent.restService?b.$parent.restService:b.$parent.rpcService,b.filterOptions=b.$parent.filterOptions,b.validatorOptions=b.$parent.validatorOptions,b.addInput=function(){if(!b.newInput||null===b.newInput||""===b.newInput||b.newInput.match(/^\s+$/))return void(c.error="Must provide an input name!");var a=!1;return b.service.input_filter.every(function(c){return b.newInput===c.name?(a=!0,!1):!0}),a?void(c.error="Input by the name "+b.newInput+" already exists!"):(b.service.input_filter.push({name:b.newInput,required:!0,filters:[],validators:[]}),void(b.newInput=""))},b.validateInputName=function(a){if(!a||null===a||""===a||a.match(/^\s+$/))return c.error="Input name can not be empty!",!1;var d=!1;return b.service.input_filter.every(function(b){return a===b.name?(d=!0,!1):!0}),d?(c.error="Input by the name "+a+" already exists!",!1):!0},b.removeInput=function(a){b.service.input_filter.splice(a,1)},b.removeOption=function(a,b){delete a[b]},b.addFilter=function(a){a.filters.push({name:a._newFilterName,options:{}}),a._newFilterName=""},b.removeFilter=function(a,b){a.filters.splice(b,1)},b.addFilterOption=function(a){"bool"==b.filterOptions[a.name][a._newOptionName]&&(a._newOptionValue="true"===a._newOptionValue),a.options[a._newOptionName]=a._newOptionValue,a._newOptionName="",a._newOptionValue=""},b.addValidator=function(a){a.validators.push({name:a._newValidatorName,options:{}}),a._newValidatorName=""},b.removeValidator=function(a,b){a.validators.splice(b,1)},b.addValidatorOption=function(a){"bool"==b.validatorOptions[a.name][a._newOptionName]&&(a._newOptionValue=a._newOptionValue===!0),a.options[a._newOptionName]=a._newOptionValue,a._newOptionName="",a._newOptionValue=""},b.saveInput=function(){function c(b,d,e){"string"==typeof d&&-1!=["_","$"].indexOf(d.charAt(0))?delete e[d]:b instanceof Object&&a.forEach(b,c)}var d=a.cloneDeep(b.service.input_filter);a.forEach(d,c);var e=b.$parent.ApiRepository;e.saveInputFilter(b.service,d),b.$parent.flash.success="Input Filter configuration saved."}}])}(_),function(){"use strict";angular.module("ag-admin").controller("ApiVersionController",["$scope","$timeout","$state","$stateParams","flash","ApiRepository",function(a,b,c,d,e,f){f.getApi(d.apiName,d.version).then(function(b){a.api=b,a.currentVersion=b.version,a.defaultApiVersion=b.default_version}),a.createNewApiVersion=function(){f.createNewVersion(a.api.name).then(function(d){e.success="A new version of this API was created",b(function(){c.go("ag.api.version",{apiName:a.api.name,version:d.version})},500)})},a.setDefaultApiVersion=function(){e.info="Setting the default API version to "+a.defaultApiVersion,f.setDefaultApiVersion(a.api.name,a.defaultApiVersion).then(function(b){e.success="Default API version updated",a.defaultApiVersion=b.version})},a.changeVersion=function(){b(function(){c.go(c.$current,{version:a.currentVersion})},500)}}])}(),function(){"use strict";angular.module("ag-admin").controller("AuthenticationController",["$scope","flash","AuthenticationRepository",function(a,b,c){a.showSetupButtons=!1,a.showHttpBasicAuthenticationForm=!1,a.showHttpBasicAuthentication=!1,a.showHttpDigestAuthenticationForm=!1,a.showHttpDigestAuthentication=!1,a.showOAuth2AuthenticationForm=!1,a.showOAuth2Authentication=!1,a.removeAuthenticationForm=!1,a.httpBasic=null,a.httpDigest=null,a.oauth2=null;var d=function(){a.showSetupButtons=!0,a.showHttpBasicAuthentication=!1,a.showHttpDigestAuthentication=!1,a.showOAuth2Authentication=!1,a.removeAuthenticationForm=!1,a.httpBasic=null,a.httpDigest=null,a.oauth2=null},e=function(b){c.fetch({cache:!b}).then(function(b){"http_basic"==b.type?(a.showSetupButtons=!1,a.showHttpBasicAuthentication=!0,a.showHttpDigestAuthentication=!1,a.showOAuth2Authentication=!1,a.httpBasic=b,a.httpDigest=null,a.oauth2=null):"http_digest"==b.type?(a.showSetupButtons=!1,a.showHttpDigestAuthentication=!0,a.showHttpBasicAuthentication=!1,a.showOAuth2Authentication=!1,a.digest_domains=b.digest_domains.split(" "),a.httpDigest=b,a.httpDigest.digest_domains=b.digest_domains.split(" "),a.httpBasic=null,a.oauth2=null):"oauth2"==b.type?(a.showSetupButtons=!1,a.showOAuth2Authentication=!0,a.showHttpDigestAuthentication=!1,a.showHttpBasicAuthentication=!1,a.oauth2=b,a.httpDigest=null,a.httpBasic=null):d()},function(){return d(),!1})},f=function(d){c.createAuthentication(d).then(function(){b.success="Authentication created",e(!0),a.removeAuthenticationForm=!1,a.resetForm()},function(){b.error("Unable to create authentication; please verify that the DSN is valid.")})},g=function(a){a.hasOwnProperty("digest_domains")&&"object"==typeof a.digest_domains&&Array.isArray(a.digest_domains)&&(a.digest_domains=a.digest_domains.join(" ")),c.updateAuthentication(a).then(function(){b.success="Authentication updated",e(!0)},function(){b.error("Unable to update authentication; please verify that the DSN is valid.")})};a.resetForm=function(){a.showHttpBasicAuthenticationForm=!1,a.showHttpDigestAuthenticationForm=!1,a.showOAuth2AuthenticationForm=!1,a.digest_domains="",a.dsn="",a.htdigest="",a.htpasswd="",a.nonce_timeout="",a.password="",a.realm="",a.route_match="",a.username=""},a.showAuthenticationSetup=function(){return a.showHttpBasicAuthenticationForm||a.showHttpDigestAuthenticationForm||a.showOAuth2AuthenticationForm?!1:a.showSetupButtons},a.createHttpBasicAuthentication=function(){var b={accept_schemes:["basic"],realm:a.realm,htpasswd:a.htpasswd};f(b)},a.createHttpDigestAuthentication=function(){var b={accept_schemes:["digest"],realm:a.realm,htdigest:a.htdigest,digest_domains:a.digest_domains.join(" "),nonce_timeout:a.nonce_timeout};f(b)},a.createOAuth2Authentication=function(){var b={dsn:a.dsn,username:a.username,password:a.password,route_match:a.route_match};f(b)},a.updateHttpBasicAuthentication=function(){var b={realm:a.httpBasic.realm,htpasswd:a.httpBasic.htpasswd};g(b)},a.updateHttpDigestAuthentication=function(){var b={realm:a.httpDigest.realm,htdigest:a.httpDigest.htdigest,digest_domains:a.httpDigest.digest_domains.join(" "),nonce_timeout:a.httpDigest.nonce_timeout};g(b)},a.updateOAuth2Authentication=function(){var b={dsn:a.oauth2.dsn,username:a.oauth2.username,password:a.oauth2.password,route_match:a.oauth2.route_match};g(b)},a.removeAuthentication=function(){c.removeAuthentication().then(function(){b.success="Authentication removed",e(!0)})},e(!0)}])}(),function(a){"use strict";angular.module("ag-admin").controller("ContentNegotiationController",["$scope","$location","flash","selectors","ContentNegotiationResource",function(b,c,d,e,f){var g={content_name:"",viewModel:"",selectors:{}};b.showNewSelectorForm=!1,b.newSelector=a.cloneDeep(g),b.selectors=a.cloneDeep(e),b.resetNewSelectorForm=function(){b.showNewSelectorForm=!1,b.newSelector=a.cloneDeep(g)},b.addViewModel=function(a,c){c.selectors[a]=[],b.newSelector.viewModel=""},b.removeViewModel=function(a,b){delete b.selectors[a]},b.resetSelectorForm=function(a){var c,d=a.content_name;angular.forEach(e,function(a){c||a.content_name!==d||(c=a)}),c&&angular.forEach(b.selectors,function(a,d){a.content_name===c.content_name&&(b.selectors[d]=c)})},b.createSelector=function(){delete b.newSelector.viewModel,f.createSelector(b.newSelector).then(function(a){e.push(a),b.selectors.push(a),d.success="New selector created",b.resetNewSelectorForm()})},b.updateSelector=function(a){delete a.viewModel,f.updateSelector(a).then(function(a){var b=!1;angular.forEach(e,function(c,d){b||c.content_name!==a.content_name||(e[d]=a,b=!0)}),d.success="Selector updated"})},b.removeSelector=function(c){f.removeSelector(c).then(function(){d.success="Selector removed",f.getList().then(function(c){e=c,b.selectors=a.cloneDeep(e)})})}}])}(_),function(){"use strict";angular.module("ag-admin").controller("DashboardController",["$rootScope","flash",function(a){a.pageTitle="Dashboard",a.pageDescription="Global system configuration and configuration to be applied to all APIs."}])}(),function(){"use strict";angular.module("ag-admin").controller("DbAdapterController",["$scope","flash","DbAdapterResource","dbAdapters",function(a,b,c,d){a.dbAdapters=d,a.showNewDbAdapterForm=!1,a.resetForm=function(){return a.showNewDbAdapterForm=!1,a.adapterName="",a.driver="",a.database="",a.username="",a.password="",a.hostname="",a.port="",a.charset="",!0};var e=function(b){a.dbAdapters=[],c.getList(b).then(function(b){a.dbAdapters=b})};a.createNewDbAdapter=function(){var d={adapter_name:a.adapter_name,driver:a.driver,database:a.database,username:a.username,password:a.password,hostname:a.hostname,port:a.port,charset:a.charset};c.createNewAdapter(d).then(function(){b.success="Database adapter created",e(!0),a.resetForm()})},a.saveDbAdapter=function(d){var f=a.dbAdapters[d],g={driver:f.driver,database:f.database,username:f.username,password:f.password,hostname:f.hostname,port:f.port,charset:f.charset};c.saveAdapter(f.adapter_name,g).then(function(a){b.success="Database adapter "+a.adapter_name+" updated",e(!0)})},a.removeDbAdapter=function(d){c.removeAdapter(d).then(function(){b.success="Database adapter "+d+" removed",e(!0),a.deleteDbAdapter=!1})}}])}(_),function(){"use strict";angular.module("ag-admin").directive("agCacheModal",["CacheEnabledResource",function(a){return{restrict:"E",replace:!0,templateUrl:"zf-apigility-admin/dist/html/modals/cache-check.html",controller:["$scope",function(b){b.isEnabled=!1,a.getCacheStatus().then(function(a){b.isEnabled=a})}],link:function(a,b){a.$watch("isEnabled",function(a){a&&b.modal("show")})}}}])}(),function(){"use strict";angular.module("ag-admin").directive("collapse",function(){return{restrict:"E",transclude:!0,scope:{show:"&"},controller:["$scope","$parse",function(a){var b,c,d,e=[],f={};this.noChevron=!1;var g=this,h={};this.addButton=function(a){angular.forEach(a.criteria,function(b,c){a.criteria[c]=!!b}),e.push(a)},a.setConditionals=function(a){angular.forEach(a,function(a,b){f[b]=!!a})},a.setNoChevron=function(a){g.noChevron=!!a,c&&c.remove()},this.setFlags=function(a){angular.forEach(a,function(a,b){h.hasOwnProperty(b)?angular.forEach(h[b],function(b){b(a)}):f[b]=!!a})},this.addConditionalWatcher=function(a,b){angular.forEach(a,function(a,c){f.hasOwnProperty(c)||(f[c]=!1),a=!!a,"undefined"==typeof h[c]&&(h[c]=[]),h[c].push(function(d){d=!!d,f[c]=d,b.toggleClass("hide",a!==d)})})},a.showContainerButtons=this.showContainerButtons=function(){var a=!1;angular.forEach(e,function(b){var c=a;angular.forEach(b.criteria,function(a,b){f.hasOwnProperty(b)&&(c=c||f[b]!==a)}),b.element.toggleClass("hide",c)})},a.hideContainerButtons=this.hideContainerButtons=function(a){b.hasClass("in");angular.forEach(e,function(b){if(a.hasOwnProperty("leave")&&a.leave)return void b.element.toggleClass("hide",!0);var c=!0;angular.forEach(b.criteria,function(a,b){c&&f.hasOwnProperty(b)&&(c=f[b]===a)}),b.element.toggleClass("hide",c)})},this.setHead=function(a){d=a},this.setBody=function(c){b=c,b.hasClass("in")&&g.toggleChevron("up"),a.$watch(function(){return b.attr("class")},function(){g.toggleChevron(b.hasClass("in")?"up":"down")})},this.setChevron=function(a){c=a},this.expand=function(){b.addClass("in")},this.collapse=function(){b.removeClass("in")},this.toggle=function(){b.toggleClass("in"),g.toggleChevron()},this.toggleChevron=function(a){if(!g.noChevron&&c){("undefined"==typeof a||null===a)&&(a=b.hasClass("in")?"up":"down");var d="up"===a?"down":"up",e="up"===d?"down":"up",f="glyphicon-chevron-"+d,h="glyphicon-chevron-"+e;c.hasClass(f)&&(c.removeClass(f),c.addClass(h))}}}],link:function(a,b,c){c.hasOwnProperty("show")&&"function"==typeof a.show&&(a.show()||b.toggleClass("hide",!0)),c.hasOwnProperty("conditionals")&&a.setConditionals(a.$eval(c.conditionals)),c.hasOwnProperty("noChevron")&&a.setNoChevron(!0)},template:'<div class="panel" ng-transclude></div>',replace:!0}}).directive("collapseHeader",function(){return{require:"^collapse",restrict:"E",transclude:!0,link:function(a,b,c,d){if(d.setHead(a),!d.noChevron){var e=angular.element('<i class="glyphicon glyphicon-chevron-down"></i>'),f=angular.element('<div class="ag-chevron pull-right"></div>');f.append(e),b.prepend(f),d.setChevron(e)}b.on("click",function(){d.toggle()}),b.on("mouseover",function(){d.showContainerButtons()}),b.on("mouseleave",function(){d.hideContainerButtons({leave:!0})})},template:'<div class="panel-heading" ng-transclude></div>',replace:!0}}).directive("collapseBody",function(){return{require:"^collapse",restrict:"E",transclude:!0,link:function(a,b,c,d){d.setBody(b)},template:'<div class="panel-collapse collapse" ng-transclude></div>',replace:!0}}).directive("collapseButton",function(){return{require:"^collapse",restrict:"A",link:function(a,b,c,d){var e={};c.hasOwnProperty("criteria")&&(e=a.$eval(c.criteria),"object"!=typeof e&&(e={})),d.addButton({criteria:e,element:b}),b.addClass("hide"),b.on("click",function(a){d.expand(),d.showContainerButtons(),a.stopPropagation()})}}}).directive("collapseFlag",function(){return{require:"^collapse",restrict:"A",link:function(a,b,c,d){if(c.hasOwnProperty("flags")){var e=a.$eval(c.flags);"object"==typeof e&&b.on("click",function(){d.setFlags(e)})}}}}).directive("collapseShow",function(){return{require:"^collapse",restrict:"A",link:function(a,b,c,d){if(c.hasOwnProperty("criteria")){var e=a.$eval(c.criteria);"object"==typeof e&&d.addConditionalWatcher(e,b)}}}})}(),function(){"use strict";angular.module("ag-admin").directive("agComment",function(){return{restrict:"E",compile:function(a){a.replaceWith("")}}})}(),function(){"use strict";angular.module("ag-admin").directive("agEditInplace",function(){return{restrict:"E",replace:!0,scope:{agInputName:"=name",validate:"&"},templateUrl:"/zf-apigility-admin/src/html/directives/ag-edit-inplace.html",controller:["$scope",function(a){var b;a.isFormVisible=!1,a.setInitialValue=function(a){b=a},a.resetForm=function(){a.agInputName=b,a.isFormVisible=!1}}],link:function(a,b,c){b.on("click",function(a){a.stopPropagation()}),a.setInitialValue(a.agInputName);var d=angular.element(b.children()[0]),e=angular.element(b.children()[1]);c.hasOwnProperty("validate")&&"function"==typeof a.validate?e.on("submit",function(){a.validate(a.agInputName)&&(a.isFormVisible=!1)}):e.on("submit",function(){a.isFormVisible=!1}),a.$watch("isFormVisible",function(a){return a?(d.toggleClass("hide",!0),void e.toggleClass("hide",!1)):(d.toggleClass("hide",!1),void e.toggleClass("hide",!0))})}}})}(),function(){"use strict";angular.module("ag-admin").directive("agHover",function(){return{restrict:"A",controller:["$scope",function(a){var b;this.setTarget=function(a){b=a},this.toggleHide=a.toggleHide=function(a){b.toggleClass("hide",a)}}],link:function(a,b){b.on("mouseover",function(){a.toggleHide(!1)}),b.on("mouseleave",function(){a.toggleHide(!0)})}}}).directive("agHoverTarget",function(){return{require:"^agHover",restrict:"A",link:function(a,b,c,d){d&&(d.setTarget(b),d.toggleHide(!0))}}})}(),function(a){"use strict";angular.module("ag-admin").directive("agInclude",["$http","$templateCache","$compile",function(b,c,d){return{restrict:"E",transclude:!0,replace:!0,link:function(e,f,g){return g.hasOwnProperty("src")?void b.get(g.src,{cache:c}).success(function(a){var b=angular.element("<div/>").html(a).contents();f.html(b),d(b)(e)}):void a.error('ag-include requires a "src" attribute; none provided!')}}}])}(console),function(){"use strict";angular.module("ag-admin").directive("agModalDismiss",function(){return{restrict:"A",link:function(a,b){a.dismissModal=function(){b.modal("hide")}}}})}(),function(){"use strict";angular.module("ag-admin").directive("agTabs",function(){return{restrict:"E",transclude:!0,scope:{parent:"="},controller:["$scope","$element",function(a){var b=a.panes=[];a.select=function(a){angular.forEach(b,function(a){a.selected=!1}),a.selected=!0},this.addPane=function(c){0===b.length&&a.select(c),b.push(c)}}],link:function(a,b,c){var d="nav-tabs";c.hasOwnProperty("pills")&&(d="nav-pills"),angular.forEach(b.children(),function(a){a=angular.element(a),"UL"===a.context.tagName&&a.addClass(d)})},template:'<div class="ag-tabs"><ul class="nav"><li ng-repeat="pane in panes" ng-class="{active:pane.selected}"><a href="" ng-click="select(pane)">{{pane.title}}</a></li></ul><div class="tab-content" ng-transclude></div></div>',replace:!0}}).directive("agTabPane",function(){return{require:"^agTabs",restrict:"E",transclude:!0,scope:{title:"@"},link:function(a,b,c,d){d.addPane(a)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}})}(),function(){"use strict";
angular.module("ag-admin").filter("servicetype",function(){return function(a){var b=a.split("::");switch(b[1]){case"__collection__":return"(Collection)";case"__resource__":return"(Entity)";default:return""}}})}(),function(){"use strict";angular.module("ag-admin").filter("namespaceclassid",function(){return function(a){return a.replace(/\\/g,"_")}})}(),function(){"use strict";angular.module("ag-admin").filter("servicename",function(){return function(a){var b=/^[^\\]+\\{1,2}V[^\\]+\\{1,2}(Rest|Rpc)\\{1,2}([^\\]+)\\{1,2}.*?Controller.*?$/;return a.match(b)?a.replace(b,"$2"):a}})}(),function(a){"use strict";angular.module("ag-admin").factory("ApiAuthorizationRepository",["$http","apiBasePath","Hal",function(b,c,d){return{getApiAuthorization:function(a,e,f){f=!!f,"string"==typeof e&&(e=parseInt(e.match(/\d/g)[0],10));var g={method:"GET",url:c+"/module/"+a+"/authorization",params:{version:e},cache:!f};return b(g).then(function(a){return d.props(a.data)})},getServiceAuthorizations:function(b,c,d){return this.getApiAuthorization(c,d).then(function(c){var d,e={},f=!1,g=b.controller_service_name;g=g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var h=new RegExp("^"+g+"::(.*?)$"),i=new RegExp("^__([^_]+)__$");return a.forEach(c,function(a,b){if(!f&&(d=h.exec(b),Array.isArray(d))){var c=d[1];if(d=i.exec(c),Array.isArray(d)){var g=d[1];return"resource"==g&&(g="entity"),void(e[g]=a)}e=a,f=!0}}),e})},saveApiAuthorizations:function(a,e){var f=c+"/module/"+a+"/authorization";return b.put(f,e).then(function(a){return d.props(a.data)})}}}])}(_),function(a){"use strict";angular.module("ag-admin").factory("ApiRepository",["$q","$http","apiBasePath","Hal",function(b,c,d,e){var f=d+"/module";return{currentApiModel:null,getList:function(a){a=!!a;var b={method:"GET",url:f,cache:!a};return c(b).then(function(a){var b=e.pluckCollection("module",a.data);return b=e.stripLinks(b),e.stripEmbedded(b)})},getApi:function(d,g,h){h=!!h;var i={},j=b.defer(),k=this;if("string"==typeof g&&(g=parseInt(g.match(/\d/g)[0],10)),!h&&k.currentApiModel&&g&&k.currentApiModel.name==d&&k.currentApiModel.version==g)return j.resolve(k.currentApiModel),j.promise;var l={method:"GET",url:f,cache:!h};return c(l).then(function(b){var c=e.pluckCollection("module",b.data),f=a.find(c,function(a){return a.name===d});return a.forEach(e.stripLinks(f),function(a,b){i[b]=a}),i.restServices=[],i.rpcServices=[],g||(g=f.versions[f.versions.length-1]),f}).then(function(b){var d=k.getHttpConfigFromLink("rest",b);return d.method="GET",d.params.version=g,c(d).then(function(c){return i.restServices=e.pluckCollection("rest",c.data),a.forEach(i.restServices,function(b){if(b._self=e.getLink("self",b),b.input_filter=[],b.documentation=[],b._embedded&&(b._embedded&&b._embedded.input_filters&&b._embedded.input_filters[0]&&(b.input_filter=e.props(b._embedded.input_filters[0]),a.forEach(b.input_filter,function(a,c){k.marshalInputFilter(b,a,c)}),b.input_filter=a.toArray(b.input_filter)),b._embedded.documentation)){var c=e.pluckCollection("documentation",b);b.documentation=e.props(c)}}),b})}).then(function(b){var d=k.getHttpConfigFromLink("rpc",b);return d.method="GET",d.params.version=g,c(d).then(function(c){return i.rpcServices=e.pluckCollection("rpc",c.data),a.forEach(i.rpcServices,function(b){if(b._self=e.getLink("self",b),b.input_filter=[],b.documentation=[],b._embedded&&(b._embedded.input_filters&&b._embedded.input_filters[0]&&(b.input_filter=e.props(b._embedded.input_filters[0]),a.forEach(b.input_filter,function(a,c){k.marshalInputFilter(b,a,c)}),b.input_filter=a.toArray(b.input_filter)),b._embedded.documentation)){var c=e.pluckCollection("documentation",b);b.documentation=e.props(c)}}),b})}).then(function(){j.resolve(i),k.currentApiModel=i,k.currentApiModel.version=g}),j.promise},createNewApi:function(a){return c.post(f,{name:a}).then(function(a){return a.data})},createNewRestService:function(a,b){return c.post(f+"/"+a+"/rest",{resource_name:b}).then(function(a){return a.data})},createNewDbConnectedService:function(a,b,d){return c.post(f+"/"+a+"/rest",{adapter_name:b,table_name:d}).then(function(a){return a.data})},createNewRpcService:function(a,b,d){return c.post(f+"/"+a+"/rpc",{service_name:b,route:d}).then(function(a){return a.data})},removeRestService:function(a,b){var d=f+"/"+a+"/rest/"+encodeURIComponent(b);return c.delete(d).then(function(a){return a.data})},saveRestService:function(a,b){var d=f+"/"+a+"/rest/"+encodeURIComponent(b.controller_service_name);return c({method:"patch",url:d,data:b}).then(function(a){return a.data})},saveInputFilter:function(a,b){var d=a._self+"/input-filter";return c.put(d,b)},saveDocumentation:function(a){var b=a._self+"/doc";return c.put(b,a.documentation)},removeRpcService:function(a,b){var d=f+"/"+a+"/rpc/"+encodeURIComponent(b);return c.delete(d).then(function(a){return a.data})},saveRpcService:function(a,b){var d=f+"/"+a+"/rpc/"+encodeURIComponent(b.controller_service_name);return c({method:"patch",url:d,data:b}).then(function(a){return a.data})},getSourceCode:function(a,b){return c.get(d+"/source?module="+a+"&class="+b).then(function(a){return a.data})},createNewVersion:function(a){return c({method:"patch",url:d+"/versioning",data:{module:a}}).then(function(a){return a.data})},setDefaultApiVersion:function(a,b){return c({method:"patch",url:"/admin/api/default-version",data:{module:a,version:b}}).then(function(a){return a.data})},getLatestVersion:function(a){var b=a.versions,c=b.pop();return b.push(c),c},isLatestVersion:function(a){var b=this.getLatestVersion(a);return a.version===b},marshalInputFilter:function(b,c,d){return"string"==typeof c?void delete b.input_filter[d]:("undefined"==typeof c.validators?c.validators=[]:a.forEach(c.validators,function(a){("undefined"==typeof a.options||0===a.options.length)&&(a.options={})}),"undefined"==typeof c.filters?c.filters=[]:a.forEach(c.filters,function(a){("undefined"==typeof a.options||0===a.options.length)&&(a.options={})}),c.required="undefined"==typeof c.required?!0:!!c.required,c.allow_empty="undefined"==typeof c.allow_empty?!1:!!c.allow_empty,void(c.continue_if_empty="undefined"==typeof c.continue_if_empty?!1:!!c.continue_if_empty))},getHttpConfigFromLink:function(b,c){var d={uri:null,params:{}},f=e.getLink(b,c);f=f.replace(/\{[^}]+\}/,"","g");var g=f.match(/^([^?]+)\?(.*?)$/);if(!Array.isArray(g))return d.url=f,d;d.url=g[1],d.params={};var h=g[2].split("&");return a.forEach(h,function(a){return a.match(/\=/)?(a=a.split("=",2),void(d.params[a[0]]=a[1])):void(d.params[a]=!0)}),d}}}])}(_),function(){"use strict";angular.module("ag-admin").factory("AuthenticationRepository",["$http","$q","apiBasePath",function(a,b,c){var d=c+"/authentication";return{hasAuthentication:function(){return this.fetch({cache:!1}).then(function(a){var b=!0;return""===a&&(b=!1),{configured:b}},function(){return{configured:!1}})},fetch:function(b){return a.get(d,b).then(function(a){return a.data})},createAuthentication:function(b){return a.post(d,b).then(function(a){return a.data})},updateAuthentication:function(b){return a({method:"patch",url:d,data:b}).then(function(a){return a.data})},removeAuthentication:function(){return a.delete(d).then(function(){return!0},function(){return!1})}}}])}(),function(){"use strict";angular.module("ag-admin").factory("ContentNegotiationResource",["$http","flash","apiBasePath",function(a,b,c){var d=c+"/content-negotiation";return{prepareSelector:function(a){var b={content_name:a.content_name};return angular.forEach(a.selectors,function(a,c){b[c]=a}),b},getList:function(){return a({method:"GET",url:d}).then(function(a){return a.data._embedded.selectors},function(){b.error="Unable to fetch content negotiation selectors; you may need to reload the page"})},createSelector:function(c){return a({method:"POST",url:d,data:this.prepareSelector(c)}).then(function(a){return a.data},function(a){return b.error="Unable to create selector; please try again",a})},updateSelector:function(c){var e=d+"/"+encodeURIComponent(c.content_name),f=this.prepareSelector(c);return delete f.content_name,a({method:"PATCH",url:e,data:f}).then(function(a){return a.data},function(a){return b.error="Unable to create selector; please try again",a})},removeSelector:function(c){var e=d+"/"+encodeURIComponent(c);return a({method:"DELETE",url:e}).then(function(a){return a.data},function(a){return b.error="Unable to remove selector; please try again",a})}}}])}(),function(){"use strict";angular.module("ag-admin").factory("DbAdapterResource",["$http","apiBasePath","Hal",function(a,b,c){var d=b+"/db-adapter";return{getList:function(b){b=!!b;var e={method:"GET",url:d,cache:!b};return a(e).then(function(a){var b=c.pluckCollection("db_adapter",a.data);return c.props(b)})},createNewAdapter:function(b){return a.post(d,b).then(function(a){return c.props(a.data)})},saveAdapter:function(b,e){return a({method:"patch",url:d+"/"+encodeURIComponent(b),data:e}).then(function(a){return c.props(a.data)})},removeAdapter:function(b){return a.delete(d+"/"+encodeURIComponent(b)).then(function(){return!0})}}}])}(_),function(){"use strict";angular.module("ag-admin").factory("FiltersServicesRepository",["$http","flash","apiBasePath",function(a,b,c){var d=c+"/filters";return{getList:function(){var c=a({method:"GET",url:d}).then(function(a){return a.data.filters},function(){return b.error="Unable to fetch filters for filter dropdown; you may need to reload the page",!1});return c}}}])}(),function(){"use strict";angular.module("ag-admin").factory("HydratorServicesRepository",["$http","flash","apiBasePath",function(a,b,c){var d=c+"/hydrators";return{getList:function(){var c=a({method:"GET",url:d}).then(function(a){return a.data.hydrators},function(){b.error="Unable to fetch hydrators for hydrator dropdown; you may need to reload the page"});return c}}}])}(),function(){"use strict";angular.module("ag-admin").factory("toggleSelection",function(){return function(a,b){var c=b.target;c.checked?a.push(c.value):a.splice(a.indexOf(c.value),1)}})}(),function(){"use strict";angular.module("ag-admin").factory("ValidatorsServicesRepository",["$http","flash","apiBasePath",function(a,b,c){var d=c+"/validators";return{getList:function(){var c=a({method:"GET",url:d}).then(function(a){return a.data.validators},function(){return b.error="Unable to fetch validators for validator dropdown; you may need to reload the page",!1});return c}}}])}(),function(a){"use strict";angular.module("ag-admin").factory("Hal",function(){return{props:function(a){return a=this.stripLinks(a),this.stripEmbedded(a)},stripLinks:function(b){if("object"!=typeof b)return b;if(Array.isArray(b)){var c=this;return a.forEach(b,function(a){b.key=c.stripLinks(a)}),b}if(!b._links)return b;var d=a.cloneDeep(b);return delete d._links,d},stripEmbedded:function(b){if("object"!=typeof b)return b;if(Array.isArray(b)){var c=this;return a.forEach(b,function(a){b.key=c.stripEmbedded(a)}),b}if(!b._embedded)return b;var d=a.cloneDeep(b);return delete d._embedded,d},pluckCollection:function(b,c){if("object"!=typeof c||Array.isArray(c))return[];if(!c._embedded)return[];if(!c._embedded[b])return[];var d=a.cloneDeep(c._embedded[b]);return d},getLink:function(a,b){return"object"!=typeof b||Array.isArray(b)?!1:b._links&&b._links[a]&&b._links[a].href?b._links[a].href:!1}}})}(_);