!function(){"use strict";angular.module("ag-admin",["ui.bootstrap","ui.router","ngSanitize","ngTagsInput","angular-flash.service","angular-flash.flash-alert-directive","ui.sortable","ui.select2","toggle-switch"]).config(["$provide","$stateProvider","$urlRouterProvider",function(a,b,c){a.value("apiBasePath",angular.element("body").data("api-base-path")||"/admin/api"),b.state("ag",{"abstract":!0,views:{breadcrumbs:{templateUrl:"html/breadcrumbs.html",controller:["$rootScope","$scope","$state",function(a,b,c){b.breadcrumbs=[];var d={title:"Home",href:"ag.settings.overview",active:!1},e=function(a){if(!a.url||!a.data)return!1;if(!a.data.pageTitle&&!a.data.breadcrumb)return!1;var b="";"string"==typeof a.data.breadcrumb?b=a.data.breadcrumb:"function"==typeof a.data.breadcrumb?b=a.data.breadcrumb(c.params):a.data.pageTitle&&(b=a.data.pageTitle);var d={title:b,href:a.name,active:!1};return d},f=function(){for(var a=[],f=c.$current.name,g=c.$current;"ag"!==g.name;){var h=e(g);if(h&&(g.name===f&&(h.active=!0),a.unshift(h)),!g.parent)break;g=g.parent}a.unshift(d);var i=[];a=a.filter(function(a){return-1===i.lastIndexOf(a.href)?(i.push(a.href),!0):!1}),b.breadcrumbs=a,b.params=c.params};a.$on("$stateChangeSuccess",f),f()}]},title:{template:'<h1 ng-bind="pageTitle"></h1>',controller:["$rootScope","$scope","$state",function(a,b,c){var d=function(a,d){if(a!==d&&d){var e;c.current&&c.current.data&&c.current.data.pageTitle&&("string"==typeof c.current.data.pageTitle?e=c.current.data.pageTitle:"function"==typeof c.current.data.pageTitle&&(e=c.current.data.pageTitle(c.params))),b.pageTitle=e}};a.$on("$stateChangeSuccess",function(){d(null,c.$current.name)}),d(null,c)}]},sidebar:{templateUrl:"html/settings/sidebar.html",controller:["$scope","$state",function(a,b){var c=function(){a.active=b.current.name};a.$watch(function(){return b.current.name},c),c()}]}}}),b.state("ag.settings",{"abstract":!0,url:"/settings"}),b.state("ag.settings.overview",{url:"/overview",data:{pageTitle:"Settings"},views:{"content@":{templateUrl:"html/settings/dashboard.html"}}}),b.state("ag.settings.authentication",{url:"/authentication?edit",data:{pageTitle:"Authentication"},views:{"content@":{templateUrl:"html/settings/authentication/index.html",controller:"AuthenticationController"}}}),b.state("ag.settings.content-negotiation",{url:"/content-negotiation?selector&edit",data:{pageTitle:"Content Negotiation"},resolve:{selectors:["ContentNegotiationResource",function(a){return a.getList()}]},views:{"content@":{templateUrl:"html/settings/content-negotiation/index.html",controller:"ContentNegotiationController"}}}),b.state("ag.settings.db-adapters",{url:"/db-adapters?adapter&edit",data:{pageTitle:"Database Adapters"},resolve:{dbAdapters:["DbAdapterResource",function(a){return a.getList()}]},views:{"content@":{templateUrl:"html/settings/db-adapters/index.html",controller:"DbAdapterController"}}}),b.state("ag.api",{url:"/api",data:{pageTitle:"APIs"},views:{"content@":{templateUrl:"html/api/index.html",controller:"ApiController"},"sidebar@":{templateUrl:"html/api/index-sidebar.html",controller:"CreateApiButtonController"}}}),b.state("ag.api.version",{url:"/:apiName/v:version",data:{pageTitle:function(a){return a.apiName+" (v"+a.version+")"},breadcrumb:function(a){return a.apiName+" (v"+a.version+")"}},resolve:{api:["$stateParams","ApiRepository",function(a,b){return b.getApi(a.apiName,a.version,!0)}],filters:["FiltersServicesRepository",function(a){return a.getList()}],validators:["ValidatorsServicesRepository",function(a){return a.getList()}],selectors:["ContentNegotiationResource",function(a){return a.getList().then(function(a){var b=[];return angular.forEach(a,function(a){b.push(a.content_name)}),b})}]},views:{"content@":{templateUrl:"html/api/overview.html",controller:"ApiOverviewController"},"sidebar@":{templateUrl:"html/api/sidebar.html",controller:["$scope","$state",function(a,b){var c=function(){a.active=b.current.name};a.$watch(function(){return b.current.name},c),c()}]}}}),b.state("ag.api.version.authorization",{url:"/authorization",data:{pageTitle:"Authorization",breadcrumb:!1},resolve:{apiAuthorizations:["$stateParams","ApiAuthorizationRepository",function(a,b){return b.getApiAuthorization(a.apiName,a.version,!0)}],authentication:["AuthenticationRepository",function(a){return a.hasAuthentication()}]},views:{"content@":{templateUrl:"html/api/authorization.html",controller:"ApiAuthorizationController"}}}),b.state("ag.api.version.rest",{url:"/rest-services?service&view&edit",data:{pageTitle:"REST Services",breadcrumb:!1},resolve:{dbAdapters:["DbAdapterResource",function(a){return a.getList()}],hydrators:["HydratorServicesRepository",function(a){return a.getList()}]},views:{"content@":{templateUrl:"html/api/rest-services/index.html",controller:"ApiRestServicesController"}}}),b.state("ag.api.version.rpc",{url:"/rpc-services?service&view&edit",data:{pageTitle:"RPC Services",breadcrumb:!1},views:{"content@":{templateUrl:"html/api/rpc-services/index.html",controller:"ApiRpcServicesController"}}}),c.otherwise("/settings/overview")}])}(),function(){"use strict";angular.module("ag-admin").controller("agCacheModal",["$modal","CacheEnabledResource",function(a,b){b.getCacheStatus().then(function(b){b&&a.open({templateUrl:"html/modals/cache-check.html",keyboard:!1,backdrop:"static"})})}])}(),function(){"use strict";angular.module("ag-admin").controller("agFsPermsModal",["$modal","FsPermsResource",function(a,b){b.getFsPermsStatus().then(function(b){if(!b.fs_perms){var c=b.www_user;a.open({templateUrl:"html/modals/fs-perms.html",controller:function(a){a.user=c},keyboard:!1,backdrop:"static"})}})}])}(),function(){"use strict";angular.module("ag-admin").controller("ApiController",["$scope","ApiRepository",function(a,b){a.apiList=[];var c=function(b){var c=[];angular.forEach(b,function(a){var b=a.default_version;a.versions.length>0&&(b=a.versions.pop()),c.push({apiName:a.name,version:b})}),a.apiList=c};a.$on("api.updateList",function(){b.getList(!0).then(function(a){c(a)})}),b.getList().then(function(a){c(a)})}])}(),function(a){"use strict";angular.module("ag-admin").controller("ApiAuthorizationController",["$scope","$stateParams","flash","api","apiAuthorizations","authentication","ApiAuthorizationRepository","agFormHandler",function(b,c,d,e,f,g,h,i){b.api=e,b.apiAuthorizations=f,b.authentication=g;var j=c.version.match(/\d/g)[0]||1;b.editable=j==e.versions[e.versions.length-1];var k=function(){var a={};return angular.forEach(e.restServices,function(b){var c=b.controller_service_name+"::__entity__",d=b.controller_service_name+"::__collection__",e={GET:!1,POST:!1,PUT:!1,PATCH:!1,DELETE:!1},f={GET:!1,POST:!1,PUT:!1,PATCH:!1,DELETE:!1};angular.forEach(b.entity_http_methods,function(a){e[a]=!0}),angular.forEach(b.collection_http_methods,function(a){f[a]=!0}),a[c]=e,a[d]=f}),angular.forEach(e.rpcServices,function(b){var c=b.controller_service_name,d={GET:!1,POST:!1,PUT:!1,PATCH:!1,DELETE:!1};angular.forEach(b.http_methods,function(a){d[a]=!0}),a[c]=d}),a}();b.isEditable=function(a,c){if(!b.editable)return!1;if(!k.hasOwnProperty(a)){var d=a.split("::"),e=d[0];if(!k.hasOwnProperty(e))return!1;a=e}return k[a][c]},b.saveAuthorization=function(){h.saveApiAuthorizations(c.apiName,b.apiAuthorizations).then(function(){i.resetForm(b),d.success="Authorization settings saved"},function(a){i.reportError(a,b)})},b.updateColumn=function(a,c){angular.forEach(b.apiAuthorizations,function(d,e){b.isEditable(e,c)&&(b.apiAuthorizations[e][c]=a.target.checked)})},b.updateRow=function(c,d){a.forEach(["GET","POST","PUT","PATCH","DELETE"],function(a){b.isEditable(d,a)&&(b.apiAuthorizations[d][a]=c.target.checked)})},b.showTopSaveButton=function(){return Object.keys(f).length>10}}])}(_),function(){"use strict";angular.module("ag-admin").controller("CreateApiController",["$scope","$modalInstance","$rootScope","$state","flash","ApiRepository","agFormHandler",function(a,b,c,d,e,f,g){a.apiName="";var h=function(){g.resetForm(a),a.apiName=""};a.createNewApi=function(i){var j=angular.element(i.target);j.find("input").attr("disabled",!0),j.find("button").attr("disabled",!0),j.find(".ag-validation-error").remove(),f.createNewApi(a.$$childTail.apiName).then(function(a){b.close(a),h(),e.success="New API Created",c.$broadcast("api.updateList"),d.go("ag.api.version",{apiName:a.name,version:1})},function(b){g.reportError(b,a)})},a.cancel=function(){h(),b.dismiss()}}])}(),function(){"use strict";angular.module("ag-admin").controller("CreateApiButtonController",["$scope","$modal",function(a,b){a.dialog=function(){b.open({templateUrl:"html/modals/create-api-form.html",keyboard:!0,controller:"CreateApiController"})}}])}(),function(a){"use strict";angular.module("ag-admin").controller("ApiDocumentationController",["$scope","$state","$stateParams","flash","ApiRepository","ApiAuthorizationRepository","agFormHandler",function(b,c,d,e,f,g,h){var i=d.apiName,j=d.version,k={};b.service="undefined"!=typeof b.$parent.restService?b.$parent.restService:b.$parent.rpcService,b.authorizations={},"undefined"!=typeof b.$parent.restService?("undefined"==typeof b.service.documentation&&(b.service.documentation={}),Array.isArray(b.service.documentation)&&(k={},a.forEach(b.service.documentation,function(a,b){k[b]=a}),b.service.documentation=k),"undefined"==typeof b.service.documentation.collection&&(b.service.documentation.collection={}),a.forEach(b.service.collection_http_methods,function(a){"undefined"==typeof b.service.documentation.collection[a]&&(b.service.documentation.collection[a]={description:null,request:null,response:null})}),"undefined"==typeof b.service.documentation.entity&&(b.service.documentation.entity={}),a.forEach(b.service.entity_http_methods,function(a){"undefined"==typeof b.service.documentation.entity[a]&&(b.service.documentation.entity[a]={description:null,request:null,response:null})})):("undefined"==typeof b.service.documentation&&(b.service.documentation={}),Array.isArray(b.service.documentation)&&(k={},a.forEach(b.service.documentation,function(a,b){k[b]=a}),b.service.documentation=k),a.forEach(b.service.http_methods,function(a){"undefined"==typeof b.service.documentation[a]&&(b.service.documentation[a]={description:null,request:null,response:null})})),g.getServiceAuthorizations(b.service,i,j).then(function(a){b.authorizations=a}),b.requiresAuthorization=function(a,c){var d=b.authorizations;return"entity"==c||"collection"==c?d.hasOwnProperty(c)&&d[c].hasOwnProperty(a)?d[c][a]:!1:d.hasOwnProperty(a)?d[a]:!1};var l=function(a){return"object"==typeof a&&Array.isArray(a)?-1===a.lastIndexOf("application/hal+json")?!1:!0:!1},m=function(a){return new Array(4*a).join(" ")},n=function(a,b,c,d,e){return"collection"==e&&(b=b.replace(/\[[a-zA-Z0-9_\/:\-]+\]$/,"")),d&&(b+=d),m(c)+'"'+a+'": {\n'+m(c+1)+'"href": "'+b+'"\n'+m(c)+"}"},o=function(a,b){return m(b)+'"_links": {\n'+a.join(",\n")+"\n"+m(b)+"}\n"},p=function(a,b,c){var d=[n("self",b,5)],e=m(1)+'"_embedded": {\n'+m(2)+'"'+a+'": [\n'+m(3)+"{\n";return e+=o(d,4),e+=c.join(",\n")+"\n"+m(3)+"}\n"+m(2)+"]\n"+m(1)+"}"};b.generate=function(c,d,e,f){var g="",h=[],i=!1,j=[];if("response"==e&&b.service.accept_whitelist&&(i=l(b.service.accept_whitelist)),a.forEach(b.service.input_filter,function(a){h.push(m(1)+'"'+a.name+'": "'+(a.description||"")+'"')}),!i||"collection"==f&&"POST"!=d)if(i&&"collection"==f){var k=b.service.collection_name?b.service.collection_name:"items";a.forEach(h,function(a,b){h[b]=m(3)+a}),j.push(n("self",b.service.route_match,2,!1,"collection")),j.push(n("first",b.service.route_match,2,"?page={page}","collection")),j.push(n("prev",b.service.route_match,2,"?page={page}","collection")),j.push(n("next",b.service.route_match,2,"?page={page}","collection")),j.push(n("last",b.service.route_match,2,"?page={page}","collection")),g="{\n"+o(j,1)+p(k,b.service.route_match,h)+"\n}"}else g="{\n"+h.join(",\n")+"\n}";else j.push(n("self",b.service.route_match,2)),g="{\n"+o(j,1)+h.join(",\n")+"\n}";c[e]?c[e]+="\n"+g:c[e]=g},b.save=function(){Array.isArray(b.service.documentation)&&(k={},a.forEach(b.service.documentation,function(a,b){k[b]=a}),b.service.documentation=k),f.saveDocumentation(b.service).then(function(){h.resetForm(b),b.$parent.flash.success="Documentation saved.",c.go(c.$current.name,{edit:""},{reload:!0})},function(a){h.reportError(a,b)})}}])}(_),function(){"use strict";angular.module("ag-admin").controller("ApiOverviewController",["$scope","$state","flash","ApiRepository",function(a,b,c,d){a.api={},a.defaultApiVersion=1;var e=function(b){a.api=b,a.defaultApiVersion=b.default_version};a.setDefaultApiVersion=function(){c.info="Setting the default API version to "+a.defaultApiVersion,d.setDefaultApiVersion(a.api.name,a.defaultApiVersion).then(function(b){c.success="Default API version updated",a.defaultApiVersion=b.version})},a.$on("api.version.update",function(){d.getApi(b.params.apiName,b.params.version,!0).then(function(a){e(a)})}),d.getApi(b.params.apiName,b.params.version).then(function(a){e(a)})}])}(),function(a){"use strict";angular.module("ag-admin").controller("ApiRestServicesController",["$scope","$state","$stateParams","$sce","$modal","flash","filters","hydrators","validators","selectors","ApiRepository","api","dbAdapters","toggleSelection","agFormHandler",function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.activeService=d.service?d.service:"",b.inEdit=!!d.edit,b.view=d.view?d.view:"settings",b.ApiRepository=l,b.flash=g,b.api=m,b.version=d.version,b.dbAdapters=n,b.filterOptions=h,b.hydrators=i,b.validatorOptions=j,b.selectors=k,b.sourceCode=[],b.deleteRestService=!1,b.toggleSelection=o,b.newService={restServiceName:"",dbAdapterName:"",dbTableName:""},b.resetForm=function(){p.resetForm(b),b.showNewRestServiceForm=!1,b.newService.restServiceName="",b.newService.dbAdapterName="",b.newService.dbTableName=""},b.isLatestVersion=function(){return b.ApiRepository.isLatestVersion(b.api)},b.isLatestVersion()||(b.inEdit=!1,c.go(c.$current.name,{edit:""},{reload:!0})),b.isDbConnected=function(a){return"object"!=typeof a||"undefined"==typeof a?!1:a.hasOwnProperty("adapter_name")||a.hasOwnProperty("table_name")||a.hasOwnProperty("table_service")?!0:!1},b.newService.createNewRestService=function(){l.createNewRestService(b.api.name,b.newService.restServiceName).then(function(){g.success="New Code-Connected REST service created; please wait for the list to refresh",b.resetForm(),l.refreshApi(b,c,!0,"Finished reloading REST service list")},function(a){p.reportError(a,b)})},b.newService.createNewDbConnectedService=function(){l.createNewDbConnectedService(b.api.name,b.newService.dbAdapterName,b.newService.dbTableName).then(function(){g.success="New DB-Connected REST service created; please wait for the list to refresh",b.resetForm(),l.refreshApi(b,c,!0,"Finished reloading REST service list")},function(a){p.reportError(a,b)})},b.saveRestService=function(d){var e=a.clone(b.api.restServices[d]);l.saveRestService(b.api.name,e).then(function(){p.resetForm(b),l.refreshApi(b,c,!0,"REST Service updated",function(){c.go(c.$current.name,{edit:null})})},function(a){p.reportError(a,b)})},b.removeRestService=function(a){l.removeRestService(b.api.name,a).then(function(){l.refreshApi(b,c,!0,"REST Service deleted"),b.deleteRestService=!1})},b.getSourceCode=function(a,c){l.getSourceCode(b.api.name,a).then(function(d){b.filename=a+".php",b.classType=c+" Class",b.sourceCode="string"==typeof d.source?e.trustAsHtml(d.source):"",f.open({scope:b,templateUrl:"html/modals/source-code.html"})})}}])}(_),function(a){"use strict";angular.module("ag-admin").controller("ApiRpcServicesController",["$scope","$state","$stateParams","$sce","$modal","flash","filters","validators","selectors","ApiRepository","api","toggleSelection","agFormHandler",function(b,c,d,e,f,g,h,i,j,k,l,m,n){b.activeService=d.service?d.service:"",b.inEdit=!!d.edit,b.view=d.view?d.view:"settings",b.ApiRepository=k,b.flash=g,b.api=l,b.version=d.version,b.toggleSelection=m,b.filterOptions=h,b.validatorOptions=i,b.selectors=j,b.sourceCode=[],b.deleteRpcService=!1,b.resetForm=function(){n.resetForm(b),b.showNewRpcServiceForm=!1,b.rpcServiceName="",b.rpcServiceRoute=""},b.isLatestVersion=function(){return b.ApiRepository.isLatestVersion(b.api)},b.isLatestVersion()||(b.inEdit=!1,c.go(c.$current.name,{edit:""},{reload:!0})),b.createNewRpcService=function(){k.createNewRpcService(b.api.name,b.rpcServiceName,b.rpcServiceRoute).then(function(){b.addRpcService=!1,b.resetForm(),k.refreshApi(b,c,!0,"New RPC Service created")},function(a){n.reportError(a,b)})},b.saveRpcService=function(d){var e=a.clone(b.api.rpcServices[d]);k.saveRpcService(b.api.name,e).then(function(){n.resetForm(b),k.refreshApi(b,c,!0,"RPC Service updated",function(){c.go(c.$current.name,{edit:null})})},function(a){n.reportError(a,b)})},b.removeRpcService=function(a){k.removeRpcService(b.api.name,a).then(function(){b.deleteRpcService=!1,k.refreshApi(b,c,!0,"RPC Service deleted")})},b.getSourceCode=function(a,c){k.getSourceCode(b.api.name,a).then(function(d){b.filename=a+".php",b.classType=c+" Class",b.sourceCode="string"==typeof d.source?e.trustAsHtml(d.source):"",f.open({scope:b,templateUrl:"html/modals/source-code.html"})})}}])}(_),function(a){"use strict";angular.module("ag-admin").controller("ApiServiceInputController",["$scope","$state","$modal","flash","agFormHandler",function(b,c,d,e,f){b.service="undefined"!=typeof b.$parent.restService?b.$parent.restService:b.$parent.rpcService,b.filterOptions=b.$parent.filterOptions,b.validatorOptions=b.$parent.validatorOptions,b.help=function(){d.open({templateUrl:"html/modals/help-input-filter.html",keyboard:!0})},b.addInput=function(){if(!b.newInput||null===b.newInput||""===b.newInput||b.newInput.match(/^\s+$/))return void(e.error="Must provide a field name!");var a=!1;return b.service.input_filter.every(function(c){return b.newInput===c.name?(a=!0,!1):!0}),a?void(e.error="Field by the name "+b.newInput+" already exists!"):(b.service.input_filter.push({name:b.newInput,required:!0,filters:[],validators:[]}),void(b.newInput=""))},b.validateInputName=function(a,c){if(!a||null===a||""===a||a.match(/^\s+$/))return e.error="Field name can not be empty!",!1;var d=!1;return b.service.input_filter.every(function(b){return b===c?!0:a===b.name?(d=!0,!1):!0}),d?(e.error="Field by the name "+a+" already exists!",!1):!0},b.removeInput=function(a){b.service.input_filter.splice(a,1)},b.removeOption=function(a,b){delete a[b]},b.addFilter=function(a){a.filters.push({name:a._newFilterName,options:{}}),a._newFilterName=""},b.removeFilter=function(a,b){a.filters.splice(b,1)},b.addFilterOption=function(a){"bool"==b.filterOptions[a.name][a._newOptionName]&&(a._newOptionValue="true"===a._newOptionValue),a.options[a._newOptionName]=a._newOptionValue,a._newOptionName="",a._newOptionValue=""},b.addValidator=function(a){a.validators.push({name:a._newValidatorName,options:{}}),a._newValidatorName=""},b.removeValidator=function(a,b){a.validators.splice(b,1)},b.addValidatorOption=function(a){"bool"==b.validatorOptions[a.name][a._newOptionName]&&(a._newOptionValue=a._newOptionValue===!0),a.options[a._newOptionName]=a._newOptionValue,a._newOptionName="",a._newOptionValue=""},b.saveInput=function(){function d(b,c,e){"string"==typeof c&&-1!=["_","$"].indexOf(c.charAt(0))?delete e[c]:b instanceof Object&&a.forEach(b,d)}var e=a.cloneDeep(b.service.input_filter);a.forEach(e,d),a.forEach(e,function(b){b.hasOwnProperty("error_message")&&!b.error_message.length&&delete b.error_message,b.hasOwnProperty("showNewFilterForm")&&delete b.showNewFilterForm,b.hasOwnProperty("showNewValidatorForm")&&delete b.showNewValidatorForm,a.forEach(b.filters,function(a){a.hasOwnProperty("showNewOptionForm")&&delete a.showNewOptionForm}),a.forEach(b.validators,function(a){a.hasOwnProperty("showNewOptionForm")&&delete a.showNewOptionForm})});var g=b.$parent.ApiRepository;g.saveInputFilter(b.service,e).then(function(){f.resetForm(b),b.$parent.flash.success="Fields configuration saved.",c.go(c.$current.name,{edit:""},{reload:!0})},function(a){f.reportError(a,b)})}}])}(_),function(){"use strict";angular.module("ag-admin").controller("ApiVersionController",["$scope","$state","$stateParams","flash","ApiRepository",function(a,b,c,d,e){e.getApi(c.apiName,c.version).then(function(b){a.api=b,a.currentVersion=b.version,a.defaultApiVersion=b.default_version}),a.createNewApiVersion=function(){e.createNewVersion(a.api.name).then(function(c){d.success="A new version of this API was created",b.go("ag.api.version",{apiName:a.api.name,version:c.version})})},a.setDefaultApiVersion=function(){d.info="Setting the default API version to "+a.defaultApiVersion,e.setDefaultApiVersion(a.api.name,a.defaultApiVersion).then(function(b){d.success="Default API version updated",a.defaultApiVersion=b.version})},a.changeVersion=function(){b.go(b.$current,{version:a.currentVersion})}}])}(),function(){"use strict";angular.module("ag-admin").controller("AuthenticationController",["$scope","$state","$stateParams","flash","AuthenticationRepository","agFormHandler",function(a,b,c,d,e,f){a.inEdit=!!c.edit,a.showSetupButtons=!1,a.showHttpBasicAuthenticationForm=!1,a.showHttpBasicAuthentication=!1,a.showHttpDigestAuthenticationForm=!1,a.showHttpDigestAuthentication=!1,a.showOAuth2AuthenticationForm=!1,a.showOAuth2Authentication=!1,a.removeAuthenticationForm=!1,a.httpBasic=null,a.httpDigest=null,a.oauth2=null;var g=function(){a.showSetupButtons=!0,a.showHttpBasicAuthentication=!1,a.showHttpDigestAuthentication=!1,a.showOAuth2Authentication=!1,a.removeAuthenticationForm=!1,a.httpBasic=null,a.httpDigest=null,a.oauth2=null},h=function(b){e.fetch({cache:!b}).then(function(b){"http_basic"==b.type?(a.showSetupButtons=!1,a.showHttpBasicAuthentication=!0,a.showHttpDigestAuthentication=!1,a.showOAuth2Authentication=!1,a.httpBasic=b,a.httpDigest=null,a.oauth2=null):"http_digest"==b.type?(a.showSetupButtons=!1,a.showHttpDigestAuthentication=!0,a.showHttpBasicAuthentication=!1,a.showOAuth2Authentication=!1,a.digest_domains=b.digest_domains.split(" "),a.httpDigest=b,a.httpDigest.digest_domains=b.digest_domains.split(" "),a.httpBasic=null,a.oauth2=null):"oauth2"==b.type?(a.showSetupButtons=!1,a.showOAuth2Authentication=!0,a.showHttpDigestAuthentication=!1,a.showHttpBasicAuthentication=!1,a.oauth2=b,a.httpDigest=null,a.httpBasic=null):g()},function(){return g(),!1})},i=function(b,c){e.createAuthentication(b,c).then(function(){d.success="Authentication created",h(!0),a.removeAuthenticationForm=!1,a.resetForm()},function(b){f.reportError(b,a)})};a.cancelEdit=function(){b.go(b.$current.name,{edit:null})},a.startEdit=function(){b.go(b.$current.name,{edit:!0})};var j=function(c,g){g.hasOwnProperty("digest_domains")&&"object"==typeof g.digest_domains&&Array.isArray(g.digest_domains)&&(g.digest_domains=g.digest_domains.join(" ")),e.updateAuthentication(c,g).then(function(){f.resetForm(a),d.success="Authentication updated",h(!0),b.go(b.current,{edit:""},{reload:!0})},function(b){f.reportError(b,a)})};a.resetForm=function(){f.resetForm(a),a.showHttpBasicAuthenticationForm=!1,a.showHttpDigestAuthenticationForm=!1,a.showOAuth2AuthenticationForm=!1,a.digest_domains="",a.dsn="",a.htdigest="",a.htpasswd="",a.nonce_timeout="",a.password="",a.realm="",a.route_match="",a.username=""},a.showAuthenticationSetup=function(){return a.showHttpBasicAuthenticationForm||a.showHttpDigestAuthenticationForm||a.showOAuth2AuthenticationForm?!1:a.showSetupButtons},a.createHttpBasicAuthentication=function(){var b={accept_schemes:["basic"],realm:a.realm,htpasswd:a.htpasswd};i("http-basic",b)},a.createHttpDigestAuthentication=function(){var b={accept_schemes:["digest"],realm:a.realm,htdigest:a.htdigest,digest_domains:a.digest_domains.join(" "),nonce_timeout:a.nonce_timeout};i("http-digest",b)},a.createOAuth2Authentication=function(){var b={dsn_type:a.dsn_type,database:a.database,dsn:a.dsn,route_match:a.route_match,username:a.username,password:a.password};i("oauth2",b)},a.updateHttpBasicAuthentication=function(){var b={realm:a.httpBasic.realm,htpasswd:a.httpBasic.htpasswd};j("http-basic",b)},a.updateHttpDigestAuthentication=function(){var b={realm:a.httpDigest.realm,htdigest:a.httpDigest.htdigest,digest_domains:a.httpDigest.digest_domains.join(" "),nonce_timeout:a.httpDigest.nonce_timeout};j("http-digest",b)},a.updateOAuth2Authentication=function(){var b={dsn_type:a.oauth2.dsn_type,database:a.oauth2.database,dsn:a.oauth2.dsn,route_match:a.oauth2.route_match,username:a.oauth2.username,password:a.oauth2.password};j("oauth2",b)},a.removeAuthentication=function(){var b;return a.showHttpBasicAuthentication?b="http-basic":a.showHttpDigestAuthentication?b="http-digest":a.showOAuth2Authentication&&(b="oauth2"),b?void e.removeAuthentication(b).then(function(){d.success="Authentication removed",h(!0)}):void(d.error="Could not delete authentication; could not determine authentication type.")},h(!0)}])}(),function(){"use strict";angular.module("ag-admin").controller("ContentNegotiationController",["$scope","$state","$stateParams","$modal","flash","selectors","ContentNegotiationResource","agFormHandler",function(a,b,c,d,e,f,g,h){var i={content_name:"",viewModel:"",selectors:{}};a.activeSelector=c.selector?c.selector:"",a.inEdit=!!c.edit,a.showNewSelectorForm=!1,a.newSelector=JSON.parse(JSON.stringify(i)),a.selectors=JSON.parse(JSON.stringify(f)),a.help=function(){d.open({templateUrl:"html/modals/help-content-negotiation.html",keyboard:!0})},a.resetNewSelectorForm=function(){h.resetForm(a),a.showNewSelectorForm=!1,a.newSelector=JSON.parse(JSON.stringify(i))},a.addViewModel=function(b,c){c.selectors[b]=[],a.newSelector.viewModel=""},a.removeViewModel=function(a,b){delete b.selectors[a]},a.resetSelectorForm=function(b){h.resetForm(a);var c,d=b.content_name;angular.forEach(f,function(a){c||a.content_name!==d||(c=a)}),c&&angular.forEach(a.selectors,function(b,d){b.content_name===c.content_name&&(a.selectors[d]=c)})},a.createSelector=function(){delete a.newSelector.viewModel,g.createSelector(a.newSelector).then(function(b){f.push(b),a.selectors.push(b),e.success="New selector created",a.resetNewSelectorForm()},function(b){h.reportError(b,a)})},a.updateSelector=function(b){delete b.viewModel,g.updateSelector(b).then(function(b){h.resetForm(a);var c=!1;angular.forEach(f,function(a,d){c||a.content_name!==b.content_name||(f[d]=b,c=!0)}),e.success="Selector updated"},function(b){h.reportError(b,a)})},a.removeSelector=function(a){g.removeSelector(a).then(function(){e.success="Selector removed",g.getList(!0).then(function(){b.go(b.current,{},{reload:!0,inherit:!0,notify:!0})})})}}])}(),function(){"use strict";angular.module("ag-admin").controller("DbAdapterController",["$scope","$state","$stateParams","flash","DbAdapterResource","dbAdapters","agFormHandler",function(a,b,c,d,e,f,g){a.dbAdapters=f,a.showNewDbAdapterForm=!1,a.activeAdapter=c.adapter?c.adapter:"",a.inEdit=!!c.edit,a.resetForm=function(){return g.resetForm(a),a.showNewDbAdapterForm=!1,a.adapterName="",a.driver="",a.database="",a.dsn="",a.username="",a.password="",a.hostname="",a.port="",a.charset="",!0};var h=function(a,c){e.getList(a).then(function(){c&&(d.success=c),b.go(b.current,{edit:""},{reload:!0,inherit:!0,notify:!0})})};a.createNewDbAdapter=function(){var b={adapter_name:a.adapter_name,driver:a.driver,database:a.database,username:a.username,password:a.password,hostname:a.hostname,port:a.port,charset:a.charset};a.dsn&&(b.dsn=a.dsn),e.createNewAdapter(b).then(function(){h(!0,"Database adapter created"),a.resetForm()},function(b){g.reportError(b,a)})},a.saveDbAdapter=function(b){var c=a.dbAdapters[b],d={driver:c.driver,database:c.database,username:c.username,password:c.password,hostname:c.hostname,port:c.port,charset:c.charset};c.dsn&&(d.dsn=c.dsn),e.saveAdapter(c.adapter_name,d).then(function(b){g.resetForm(a),h(!0,"Database adapter "+b.adapter_name+" updated")},function(b){g.reportError(b,a)})},a.removeDbAdapter=function(b){e.removeAdapter(b).then(function(){h(!0,"Database adapter "+b+" removed"),a.deleteDbAdapter=!1})}}])}(_),function(){"use strict";angular.module("ag-admin").directive("agCancelEdit",["$state",function(a){return{restrict:"A",link:function(b,c){c.on("click",function(){a.go(a.$current.name,{edit:null})})}}}])}(),function(){"use strict";angular.module("ag-admin").directive("agCollapse",function(){return{restrict:"E",transclude:!0,scope:{show:"&"},controller:["$scope","$parse","$state",function(a,b,c){var d,e,f,g,h,i=[],j={};this.noChevron=!1;var k,l=this,m={};this.addButton=function(a){angular.forEach(a.criteria,function(b,c){a.criteria[c]=!!b}),i.push(a)},a.setActive=function(){d&&l.expand()},a.setConditionals=function(a){angular.forEach(a,function(a,b){j[b]=!!a}),l.setFlags(j)},a.setName=function(a){h=a},a.setNoChevron=function(a){l.noChevron=!!a,f&&f.remove(),l.expand()},a.setSearchParam=function(a){k=a},this.setFlags=function(a){angular.forEach(a,function(a,b){m.hasOwnProperty(b)?angular.forEach(m[b],function(b){b(a)}):j[b]=!!a})},this.addConditionalWatcher=function(a,b){angular.forEach(a,function(a,c){j.hasOwnProperty(c)||(j[c]=!1),a=!!a,"undefined"==typeof m[c]&&(m[c]=[]),m[c].push(function(d){d=!!d,j[c]=d,"function"==typeof b&&b(d,a)})})},a.showContainerButtons=this.showContainerButtons=function(){var a=!1;angular.forEach(i,function(b){var c=a;angular.forEach(b.criteria,function(a,b){j.hasOwnProperty(b)&&(c=c||j[b]!==a)}),b.element.toggleClass("hide",c)})},a.hideContainerButtons=this.hideContainerButtons=function(a){d.hasClass("in");angular.forEach(i,function(b){if(a.hasOwnProperty("leave")&&a.leave)return void b.element.toggleClass("hide",!0);var c=!0;angular.forEach(b.criteria,function(a,b){c&&j.hasOwnProperty(b)&&(c=j[b]===a)}),b.element.toggleClass("hide",c)})},this.setHead=function(a){g=a},this.setBody=function(b,c){d=b,e=c,d.hasClass("in")&&l.toggleChevron("up"),a.$watch(function(){return d.attr("class")},function(){l.toggleChevron(d.hasClass("in")?"up":"down")})},this.setChevron=function(a){f=a},this.expand=function(a){if(d.hasClass("in"))return void("function"==typeof a&&a());if(e(!0),h&&k){var b={};b[k]=h,c.go(c.$current.name,b,{reload:!1,inherit:!0,notify:!1}).then(function(b){return"function"==typeof a&&a(),b})}},this.collapse=function(a){if(!d.hasClass("in"))return void("function"==typeof a&&a());if(!l.noChevron&&(e(!1),k)){var b={};b[k]=null,c.go(c.$current.name,b,{reload:!1,inherit:!0,notify:!1}).then(function(b){return"function"==typeof a&&a(),b})}},this.toggle=function(){d.hasClass("in")?l.collapse():l.expand(),l.toggleChevron()},this.toggleChevron=function(a){if(!l.noChevron&&f){("undefined"==typeof a||null===a)&&(a=d.hasClass("in")?"up":"down");var b="up"===a?"down":"up",c="up"===b?"down":"up",e="glyphicon-chevron-"+b,g="glyphicon-chevron-"+c;f.hasClass(e)&&(f.removeClass(e),f.addClass(g))}}}],link:function(a,b,c){c.hasOwnProperty("show")&&"function"==typeof a.show&&(a.show()||b.toggleClass("hide",!0)),c.hasOwnProperty("active")&&a.$eval(c.active)&&a.setActive(),c.hasOwnProperty("name")&&a.setName(c.name),c.hasOwnProperty("searchparam")&&a.setSearchParam(c.searchparam),c.hasOwnProperty("conditionals")&&a.setConditionals(a.$eval(c.conditionals)),c.hasOwnProperty("noChevron")&&a.setNoChevron(!0)},template:'<div class="panel" ng-transclude></div>',replace:!0}}).directive("collapseHeader",function(){return{require:"^agCollapse",restrict:"E",transclude:!0,link:function(a,b,c,d){if(d.setHead(a),!d.noChevron){var e=angular.element('<i class="glyphicon glyphicon-chevron-down"></i>'),f=angular.element('<div class="ag-chevron pull-right"></div>');f.append(e),b.prepend(f),d.setChevron(e)}b.on("click",function(){d.toggle()}),b.on("mouseover",function(){d.showContainerButtons()}),b.on("mouseleave",function(){d.hideContainerButtons({leave:!0})})},template:'<div class="panel-heading" ng-transclude></div>',replace:!0}}).directive("collapseBody",["AgTemplateInjector",function(a){return{require:"^agCollapse",restrict:"E",transclude:!0,scope:!0,link:function(b,c,d,e){var f=function(a){c.toggleClass("in",a)
};if(d.hasOwnProperty("contentTemplate")){var g=b.$eval(d.contentTemplate),h=a.defaultEmptyTemplate;d.hasOwnProperty("emptyTemplate")&&(h=b.$eval(d.emptyTemplate)),f=function(d){var e=d?g:h;a.fetchTemplate(e).then(function(e){a.populateElement(c,e,b),c.toggleClass("in",d)})};var i=c.hasClass("in")?g:h;a.fetchTemplate(i).then(function(d){a.populateElement(c,d,b)})}e.setBody(c,f)},template:'<div class="panel-collapse collapse" ng-transclude></div>',replace:!0}}]).directive("collapseButton",function(){return{require:"^agCollapse",restrict:"A",scope:!0,link:function(a,b,c,d){var e,f={};c.hasOwnProperty("criteria")&&(f=a.$eval(c.criteria),"object"!=typeof f&&(f={})),c.hasOwnProperty("collapseClick")&&(e=a.$eval(c.collapseClick)),d.addButton({criteria:f,element:b}),b.addClass("hide"),b.on("click",function(a){a.preventDefault(),a.stopPropagation(),d.expand(function(){"function"==typeof e&&e(a,b)}),d.showContainerButtons()})}}}).directive("collapseFlag",function(){return{require:"^agCollapse",restrict:"A",scope:!0,link:function(a,b,c,d){var e;if(c.hasOwnProperty("flags")){var f=a.$eval(c.flags);"object"==typeof f&&(c.hasOwnProperty("collapseClick")&&(e=a.$eval(c.collapseClick)),b.on("click",function(a){a.preventDefault(),a.stopPropagation(),d.setFlags(f),"function"==typeof e&&e(a,b)}))}}}}).directive("collapseShow",["AgTemplateInjector",function(a){return{require:"^agCollapse",restrict:"A",transclude:!0,link:function(b,c,d,e){var f=function(a,b){c.toggleClass("hide",b!==a)};if(d.hasOwnProperty("criteria")){var g=b.$eval(d.criteria);if("object"==typeof g){if(d.hasOwnProperty("defaultTemplate")&&d.hasOwnProperty("toggledTemplate")){var h=b.$eval(d.defaultTemplate),i=b.$eval(d.toggledTemplate);f=function(d,e){var f=d===e?h:i;a.fetchTemplate(f).then(function(d){a.populateElement(c,d,b)})},a.fetchTemplate(h).then(function(d){a.populateElement(c,d,b)})}e.addConditionalWatcher(g,f)}}}}}])}(),function(){"use strict";angular.module("ag-admin").directive("agComment",function(){return{restrict:"E",compile:function(a){a.replaceWith("")}}})}(),function(){"use strict";angular.module("ag-admin").directive("agConditionalInclude",["AgTemplateInjector","$compile",function(a,b){return{restrict:"E",transclude:!0,link:function(c,d,e){return e.hasOwnProperty("src")&&e.hasOwnProperty("condition")?void c.$watch(e.condition,function(f){f=!!f;var g=f?e.src:a.defaultEmptyTemplate;a.fetchTemplate(g).then(function(a){d.html(a),b(d.contents())(c)})}):void console.error('ag-include requires both a "src" and a "condition" attribute; none provided!')}}}])}(),function(){"use strict";angular.module("ag-admin").directive("agEditInplace",function(){return{restrict:"E",replace:!0,scope:{agInputName:"=name",validate:"&"},templateUrl:"html/directives/ag-edit-inplace.html",controller:["$scope",function(a){var b;a.isFormVisible=!1,a.setInitialValue=function(a){b=a},a.resetForm=function(){a.agInputName=b,a.isFormVisible=!1}}],link:function(a,b,c){b.on("click",function(a){a.stopPropagation()}),a.setInitialValue(a.agInputName);var d=angular.element(b.children()[0]),e=angular.element(b.children()[1]);a.submit=c.hasOwnProperty("validate")&&"function"==typeof a.validate?function(){a.validate(a.agInputName)&&(a.isFormVisible=!1)}:function(){a.isFormVisible=!1},e.on("submit",a.submit),a.$watch("isFormVisible",function(a){return a?(d.toggleClass("hide",!0),void e.toggleClass("hide",!1)):(d.toggleClass("hide",!1),void e.toggleClass("hide",!0))})}}})}(),function(){"use strict";angular.module("ag-admin").directive("agForm",function(){return{restrict:"A",controller:["$scope",function(a){var b=function(){var a=angular.element("<div></div>");a.addClass("panel panel-danger ag-validation-error");var b=angular.element("<div></div>");b.addClass("panel-heading");var c=angular.element("<h4></h4>");return c.addClass("panel-title"),c.text("Validation Errors"),b.append(c),a.append(b),a};a.processErrors=function(a,c){var d=b(),e=angular.element("<ul></ul>");e.addClass("list-group"),angular.forEach(a,function(a,b){if(Array.isArray(a)&&(a=a.join("<br />")),"object"==typeof a){var c=[];angular.forEach(a,function(a){c.push(a)}),a=c.join("<br />")}if("string"==typeof a){"string"==typeof b&&(a=b+": "+a);var d=angular.element("<li></li>");d.addClass("list-group-item"),d.text(a),e.append(d)}}),d.append(e),c.append(d)},a.removeErrors=function(a){a.find(".ag-validation-error").remove()}}],link:function(a,b){b.on("submit",function(){a.removeErrors(b),b.find("input").attr("disabled",!0),b.find("button").attr("disabled",!0),b.find("select").attr("disabled",!0)}),a.$on("ag-form-submit-complete",function(){b.find("input").attr("disabled",!1),b.find("button").attr("disabled",!1),b.find("select").attr("disabled",!1)}),a.$on("ag-form-validation-errors",function(c,d){a.messages=a.processErrors(d,b)}),a.$on("ag-form-validation-errors-clear",function(){b.find(".ag-validation-error").remove()})}}})}(),function(){"use strict";angular.module("ag-admin").directive("agHover",function(){return{restrict:"A",controller:["$scope",function(a){var b;this.setTarget=function(a){b=a},this.toggleHide=a.toggleHide=function(a){b.toggleClass("hide",a)}}],link:function(a,b){b.on("mouseover",function(){a.toggleHide(!1)}),b.on("mouseleave",function(){a.toggleHide(!0)})}}}).directive("agHoverTarget",function(){return{require:"^agHover",restrict:"A",link:function(a,b,c,d){d&&(d.setTarget(b),d.toggleHide(!0))}}})}(),function(a){"use strict";angular.module("ag-admin").directive("agInclude",["AgTemplateInjector","$compile",function(b,c){return{restrict:"E",transclude:!0,replace:!0,link:function(d,e,f){if(!f.hasOwnProperty("src")&&!f.hasOwnProperty("condition"))return void a.error('ag-include requires a "src" or a "condition" attribute; none provided!');var g=f.hasOwnProperty("condition")?d.$eval(f.condition):f.src;b.fetchTemplate(g).then(function(a){e.html(a),c(e.contents())(d)})}}}])}(console),function(){"use strict";angular.module("ag-admin").directive("agOnEnter",function(){return{restrict:"A",link:function(a,b,c){b.bind("keydown",function(){b.focus()}),b.bind("keyup",function(b){13===b.which&&(b.stopPropagation(),a.$apply(c.agOnEnter))})}}})}(),function(){"use strict";angular.module("ag-admin").directive("agTabs",function(){return{restrict:"E",transclude:!0,scope:{parent:"="},controller:["$scope","$element","$state",function(a,b,c){var d=a.panes=[];a.select=function(a){if(angular.forEach(d,function(a){a.selected===!0&&(a.selected=!1,angular.forEach(a.getWatchers(),function(b){b.deselect(a)}))}),a.selected=!0,angular.forEach(a.getWatchers(),function(b){b.select(a)}),a.name&&a.searchParam){var b={};b[a.searchParam]=a.name,c.go(c.$current.name,b,{inherit:!0,notify:!0})}},this.addPane=function(b){(0===d.length||b.active)&&a.select(b),d.push(b)}}],link:function(a,b,c){var d="nav-tabs";c.hasOwnProperty("pills")&&(d="nav-pills"),angular.forEach(b.children(),function(a){a=angular.element(a),"UL"===a.context.tagName&&a.addClass(d)})},template:'<div class="ag-tabs"><ul class="nav"><li ng-repeat="pane in panes" ng-class="{active:pane.selected}"><a href="" ng-click="select(pane)">{{pane.title}}</a></li></ul><div class="tab-content" ng-transclude></div></div>',replace:!0}}).directive("agTabPane",function(){return{require:"^agTabs",restrict:"E",transclude:!0,scope:{title:"@"},controller:["$scope",function(a){var b=[];this.addWatcher=function(a){b.push(a)},a.getWatchers=function(){return b}}],link:function(a,b,c,d){c.hasOwnProperty("active")&&(a.active=!!a.$eval(c.active)),c.hasOwnProperty("name")&&(a.name=c.name),c.hasOwnProperty("searchparam")&&(a.searchParam=c.searchparam),d.addPane(a)},template:'<div class="tab-pane" ng-class="{active: selected}" ng-transclude></div>',replace:!0}}).directive("agTabPaneVariableContent",["AgTemplateInjector",function(a){return{require:"^agTabPane",restrict:"E",transclude:!0,link:function(b,c,d,e){var f,g,h=a.defaultEmptyTemplate;return d.hasOwnProperty("contentTemplate")?(f=b.$eval(d.contentTemplate),d.hasOwnProperty("emptyTemplate")&&(h=b.$eval(d.emptyTemplate)),d.hasOwnProperty("onload")&&(g=d.onload),a.fetchTemplate(h).then(function(d){a.populateElement(c,d,b)}),b.select=function(b){a.fetchTemplate(f).then(function(d){a.populateElement(c,d,b,g)})},b.deselect=function(b){a.fetchTemplate(h).then(function(d){a.populateElement(c,d,b)})},void e.addWatcher(b)):void console.error("Missing content-template property in ag-tab-pane-variable-content directive; cannot continue")}}}])}(),function(){"use strict";angular.module("ag-admin").filter("servicetype",function(){return function(a){var b=a.split("::");switch(b[1]){case"__collection__":return"(Collection)";case"__entity__":return"(Entity)";default:return""}}})}(),function(){"use strict";angular.module("ag-admin").filter("namespaceclassid",function(){return function(a){return a.replace(/\\/g,"_")}})}(),function(){"use strict";angular.module("ag-admin").filter("servicename",function(){return function(a){var b=/^[^\\]+\\{1,2}V[^\\]+\\{1,2}(Rest|Rpc)\\{1,2}([^\\]+)\\{1,2}.*?Controller.*?$/;return a.match(b)?a.replace(b,"$2"):a}})}(),function(){"use strict";angular.module("ag-admin").factory("agFormHandler",["flash",function(a){return{resetForm:function(a){a.$broadcast("ag-form-submit-complete"),a.$broadcast("ag-form-validation-errors-clear")},reportError:function(b,c){if(c.$broadcast("ag-form-submit-complete"),400!==b.status&&422!==b.status)return void(a.error="Error submitting new API");var d;d=400===b.status?["Unexpected or missing data processing form"]:b.data.validation_messages,c.$broadcast("ag-form-validation-errors",d),a.error="We were unable to validate your form; please check for errors."}}}])}(_),function(){"use strict";angular.module("ag-admin").factory("AgTemplateInjector",["$templateCache","$http","$q","$compile",function(a,b,c,d){var e="html/empty.html",f={},g=function(d){return f.hasOwnProperty(d)?c.when(f[d]):b.get(d,{cache:a}).then(function(a){return f[d]=a.data,f[d]},function(a){return console.error("Unable to fetch template "+d),console.error(a),a})},h=function(a,b,c,e){a.html(b),d(a.contents())(c.$parent),e&&c.$eval(e)};return{defaultEmptyTemplate:e,fetchTemplate:g,populateElement:h}}])}(),function(a){"use strict";angular.module("ag-admin").factory("ApiAuthorizationRepository",["$http","apiBasePath","Hal",function(b,c,d){return{getApiAuthorization:function(a,e,f){f=!!f,"string"==typeof e&&(e=parseInt(e.match(/\d/g)[0],10));var g={method:"GET",url:c+"/module/"+a+"/authorization",params:{version:e},cache:!f};return b(g).then(function(a){return d.props(a.data)})},getServiceAuthorizations:function(b,c,d){return this.getApiAuthorization(c,d).then(function(c){var d,e={},f=!1,g=b.controller_service_name;g=g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var h=new RegExp("^"+g+"::(.*?)$"),i=new RegExp("^__([^_]+)__$");return a.forEach(c,function(a,b){if(!f&&(d=h.exec(b),Array.isArray(d))){var c=d[1];if(d=i.exec(c),Array.isArray(d)){var g=d[1];return"resource"==g&&(g="entity"),void(e[g]=a)}e=a,f=!0}}),e})},saveApiAuthorizations:function(a,e){var f=c+"/module/"+a+"/authorization";return b.put(f,e).then(function(a){return d.props(a.data)})}}}])}(_),function(a){"use strict";angular.module("ag-admin").factory("ApiRepository",["$q","$http","apiBasePath","Hal","flash",function(b,c,d,e,f){var g,h=d+"/module",i={};return{currentApiModel:null,getList:function(a){if(a=!!a,!a&&(Array.isArray(g)&&g.length>0||"object"==typeof g))return b.when(g);var d={method:"GET",url:h};return c(d).then(function(a){return g=e.pluckCollection("module",a.data),g=e.stripLinks(g),g=e.stripEmbedded(g)})},getApi:function(d,g,j){if(j=!!j,"string"==typeof g&&(g=parseInt(g.match(/\d/g)[0],10)),!j&&i.hasOwnProperty(d)&&i[d].hasOwnProperty(g))return b.when(i[d][g]);var k=this,l=b.defer(),m={},n={method:"GET",url:h};return c(n).then(function(c){var h=e.pluckCollection("module",c.data),i=a.find(h,function(a){return a.name===d});return void 0===i?(f.error='API "'+d+'" not found',b.reject(404)):(a.forEach(e.stripLinks(i),function(a,b){m[b]=a}),m.restServices=[],m.rpcServices=[],g||(g=i.versions[i.versions.length-1]),-1===i.versions.indexOf(g)?(f.error='Version "'+g+'" of API "'+d+'" not found',b.reject(404)):i)}).then(function(b){var d=k.getHttpConfigFromLink("rest",b);return d.method="GET",d.params.version=g,c(d).then(function(c){return m.restServices=e.pluckCollection("rest",c.data),a.forEach(m.restServices,function(b){if(b._self=e.getLink("self",b),b.input_filter=[],b.documentation=[],b._embedded&&(b._embedded&&b._embedded.input_filters&&b._embedded.input_filters[0]&&(b.input_filter=e.props(b._embedded.input_filters[0]),a.forEach(b.input_filter,function(a,c){k.marshalInputFilter(b,a,c)}),b.input_filter=a.toArray(b.input_filter)),b._embedded.documentation)){var c=e.pluckCollection("documentation",b);b.documentation=e.props(c)}}),b})}).then(function(b){var d=k.getHttpConfigFromLink("rpc",b);return d.method="GET",d.params.version=g,c(d).then(function(c){return m.rpcServices=e.pluckCollection("rpc",c.data),a.forEach(m.rpcServices,function(b){if(b._self=e.getLink("self",b),b.input_filter=[],b.documentation=[],b._embedded&&(b._embedded.input_filters&&b._embedded.input_filters[0]&&(b.input_filter=e.props(b._embedded.input_filters[0]),a.forEach(b.input_filter,function(a,c){k.marshalInputFilter(b,a,c)}),b.input_filter=a.toArray(b.input_filter)),b._embedded.documentation)){var c=e.pluckCollection("documentation",b);b.documentation=e.props(c)}}),b})}).then(function(){l.resolve(m),i.hasOwnProperty(d)||(i[d]={}),i[d][g]=m,i[d][g].version=g}),l.promise},refreshApi:function(a,b,c,d,e){return a.hasOwnProperty("api")?void this.getApi(a.api.name,a.api.version,!0).then(function(c){d&&(f.success=d),a.api=c,a.currentVersion=c.currentVersion,e&&"function"==typeof e||(e=function(){b.go(b.current,{service:null,edit:null},{reload:!0})}),e()}):void console.error("Provided scope does not have an API property; cannot refresh API")},createNewApi:function(a){return c.post(h,{name:a}).then(function(a){return a.data})},createNewRestService:function(a,b){return c.post(h+"/"+a+"/rest",{service_name:b}).then(function(a){return a.data})},createNewDbConnectedService:function(a,b,d){return c.post(h+"/"+a+"/rest",{adapter_name:b,table_name:d}).then(function(a){return a.data})},createNewRpcService:function(a,b,d){return c.post(h+"/"+a+"/rpc",{service_name:b,route_match:d}).then(function(a){return a.data})},removeRestService:function(a,b){var d=h+"/"+a+"/rest/"+encodeURIComponent(b);return c.delete(d).then(function(a){return a.data})},saveRestService:function(a,b){var d=h+"/"+a+"/rest/"+encodeURIComponent(b.controller_service_name),e=this.testForEmpty,f={accept_whitelist:b.accept_whitelist,collection_class:e(b.collection_class),collection_http_methods:b.collection_http_methods,collection_name:e(b.collection_name),collection_query_whitelist:b.collection_query_whitelist,content_type_whitelist:b.content_type_whitelist,entity_class:e(b.entity_class),entity_http_methods:b.entity_http_methods,entity_identifier_name:e(b.entity_identifier_name),hydrator_name:e(b.hydrator_name),page_size:e(b.page_size),page_size_param:e(b.page_size_param),resource_class:e(b.resource_class),route_identifier_name:e(b.route_identifier_name),route_match:e(b.route_match),selector:b.selector,service_name:b.service_name};return b.hasOwnProperty("adapter_name")&&b.adapter_name&&(f.adapter_name=b.adapter_name),b.hasOwnProperty("table_name")&&b.table_name&&(f.table_name=b.table_name),c({method:"patch",url:d,data:f}).then(function(a){return a.data})},saveInputFilter:function(a,b){var d=a._self+"/input-filter";return c.put(d,b).then(function(a){return a.data})},saveDocumentation:function(a){var b=a._self+"/doc";return c.put(b,a.documentation).then(function(a){return a.data})},removeRpcService:function(a,b){var d=h+"/"+a+"/rpc/"+encodeURIComponent(b);return c.delete(d).then(function(a){return a.data})},saveRpcService:function(a,b){var d=h+"/"+a+"/rpc/"+encodeURIComponent(b.controller_service_name),e=this.testForEmpty,f={accept_whitelist:b.accept_whitelist,content_type_whitelist:b.content_type_whitelist,controller_class:e(b.controller_class),http_methods:b.http_methods,route_match:e(b.route_match),selector:e(b.selector),service_name:b.service_name};return c({method:"patch",url:d,data:f}).then(function(a){return a.data})},getSourceCode:function(a,b){return c.get(d+"/source?module="+a+"&class="+b).then(function(a){return a.data})},createNewVersion:function(a){return c({method:"patch",url:d+"/versioning",data:{module:a}}).then(function(a){return a.data})},setDefaultApiVersion:function(a,b){return c({method:"patch",url:"/admin/api/default-version",data:{module:a,version:b}}).then(function(a){return a.data})},getLatestVersion:function(a){var b=a.versions,c=b.pop();return b.push(c),c},isLatestVersion:function(a){var b=this.getLatestVersion(a);return a.version===b},marshalInputFilter:function(b,c,d){return"string"==typeof c?void delete b.input_filter[d]:("undefined"==typeof c.validators?c.validators=[]:a.forEach(c.validators,function(a){("undefined"==typeof a.options||0===a.options.length)&&(a.options={})}),"undefined"==typeof c.filters?c.filters=[]:a.forEach(c.filters,function(a){("undefined"==typeof a.options||0===a.options.length)&&(a.options={})}),c.required="undefined"==typeof c.required?!0:!!c.required,c.allow_empty="undefined"==typeof c.allow_empty?!1:!!c.allow_empty,void(c.continue_if_empty="undefined"==typeof c.continue_if_empty?!1:!!c.continue_if_empty))},getHttpConfigFromLink:function(b,c){var d={uri:null,params:{}},f=e.getLink(b,c);f=f.replace(/\{[^}]+\}/,"","g");var g=f.match(/^([^?]+)\?(.*?)$/);if(!Array.isArray(g))return d.url=f,d;d.url=g[1],d.params={};var h=g[2].split("&");return a.forEach(h,function(a){return a.match(/\=/)?(a=a.split("=",2),void(d.params[a[0]]=a[1])):void(d.params[a]=!0)}),d},testForEmpty:function(a){return""===a?null:void 0===a?null:a}}}])}(_),function(){"use strict";angular.module("ag-admin").factory("AuthenticationRepository",["$http","$q","apiBasePath",function(a,b,c){var d=c+"/authentication";return{hasAuthentication:function(){return this.fetch({cache:!1}).then(function(a){var b=!0;return""===a&&(b=!1),{configured:b}},function(){return{configured:!1}})},fetch:function(b){return a.get(d,b).then(function(a){return a.data})},createAuthentication:function(b,c){return a.post(d+"/"+b,c).then(function(a){return a.data})},updateAuthentication:function(b,c){return a({method:"patch",url:d+"/"+b,data:c}).then(function(a){return a.data})},removeAuthentication:function(b){return a.delete(d+"/"+b).then(function(){return!0},function(){return!1})}}}])}(),function(){"use strict";angular.module("ag-admin").factory("CacheEnabledResource",["$http","flash","apiBasePath",function(a,b,c){var d=c+"/cache-enabled";return{getCacheStatus:function(){return a({method:"GET",url:d}).then(function(a){return a.data.cache_enabled},function(){b.error="Unable to fetch API opcode cache status; you may need to refresh the page."})}}}])}(),function(){"use strict";angular.module("ag-admin").factory("ContentNegotiationResource",["$http","$q","flash","apiBasePath",function(a,b,c,d){var e,f=d+"/content-negotiation";return{prepareSelector:function(a){var b={content_name:a.content_name};return angular.forEach(a.selectors,function(a,c){b[c]=a}),b},getList:function(d){return d=!!d,!d&&(Array.isArray(e)&&e.length>0||"object"==typeof e)?b.when(e):a({method:"GET",url:f}).then(function(a){return e=a.data._embedded.selectors},function(){c.to("ag-flash-error").error="Unable to fetch content negotiation selectors; you may need to reload the page"})},createSelector:function(b){return a({method:"POST",url:f,data:this.prepareSelector(b)}).then(function(a){return a.data})},updateSelector:function(b){var c=f+"/"+encodeURIComponent(b.content_name),d=this.prepareSelector(b);return delete d.content_name,a({method:"PATCH",url:c,data:d}).then(function(a){return a.data})},removeSelector:function(b){var d=f+"/"+encodeURIComponent(b);return a({method:"DELETE",url:d}).then(function(a){return a.data},function(a){return c.error="Unable to remove selector; please try again",a})}}}])}(),function(){"use strict";angular.module("ag-admin").factory("DbAdapterResource",["$http","$q","apiBasePath","Hal",function(a,b,c,d){var e,f=c+"/db-adapter";return{getList:function(c){if(c=!!c,!c&&(Array.isArray(e)&&e.length>0||"object"==typeof e))return b.when(e);var g={method:"GET",url:f};return a(g).then(function(a){return e=d.pluckCollection("db_adapter",a.data),e=d.props(e)})},createNewAdapter:function(b){return a.post(f,b).then(function(a){return d.props(a.data)})},saveAdapter:function(b,c){return a({method:"patch",url:f+"/"+encodeURIComponent(b),data:c}).then(function(a){return d.props(a.data)})},removeAdapter:function(b){return a.delete(f+"/"+encodeURIComponent(b)).then(function(){return!0})}}}])}(_),function(){"use strict";angular.module("ag-admin").factory("FiltersServicesRepository",["$http","flash","apiBasePath",function(a,b,c){var d=c+"/filters";return{getList:function(){var c=a({method:"GET",url:d}).then(function(a){return a.data.filters},function(){return b.error="Unable to fetch filters for filter dropdown; you may need to reload the page",!1});return c}}}])}(),function(){"use strict";angular.module("ag-admin").factory("FsPermsResource",["$http","flash","apiBasePath",function(a,b,c){var d=c+"/fs-permissions";return{getFsPermsStatus:function(){return a({method:"GET",url:d}).then(function(a){return a.data},function(){b.error="Unable to fetch API filesystem writability status; you may need to refresh the page."})}}}])}(),function(){"use strict";angular.module("ag-admin").factory("HydratorServicesRepository",["$http","flash","apiBasePath",function(a,b,c){var d=c+"/hydrators";return{getList:function(){var c=a({method:"GET",url:d}).then(function(a){return a.data.hydrators},function(){b.error="Unable to fetch hydrators for hydrator dropdown; you may need to reload the page"});return c}}}])}(),function(){"use strict";angular.module("ag-admin").factory("toggleSelection",function(){return function(a,b){var c=b.target;c.checked?a.push(c.value):a.splice(a.indexOf(c.value),1)}})}(),function(){"use strict";angular.module("ag-admin").factory("ValidatorsServicesRepository",["$http","flash","apiBasePath",function(a,b,c){var d=c+"/validators";return{getList:function(){var c=a({method:"GET",url:d}).then(function(a){return a.data.validators},function(){return b.error="Unable to fetch validators for validator dropdown; you may need to reload the page",!1});return c}}}])}(),function(a){"use strict";angular.module("ag-admin").factory("Hal",function(){return{props:function(a){return a=this.stripLinks(a),this.stripEmbedded(a)},stripLinks:function(b){if("object"!=typeof b)return b;if(Array.isArray(b)){var c=this;return a.forEach(b,function(a,d){b[d]=c.stripLinks(a)}),b}if(!b._links)return b;var d=a.cloneDeep(b);return delete d._links,d},stripEmbedded:function(b){if("object"!=typeof b)return b;if(Array.isArray(b)){var c=this;return a.forEach(b,function(a,d){b[d]=c.stripEmbedded(a)}),b}if(!b._embedded)return b;var d=a.cloneDeep(b);return delete d._embedded,d},pluckCollection:function(b,c){return"object"!=typeof c||Array.isArray(c)?[]:c._embedded&&c._embedded[b]?a.cloneDeep(c._embedded[b]):[]},getLink:function(a,b){return"object"!=typeof b||Array.isArray(b)?!1:b._links&&b._links[a]&&b._links[a].href?b._links[a].href:!1}}})}(_);